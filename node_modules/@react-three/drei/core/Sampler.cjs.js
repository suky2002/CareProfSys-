"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("react"),t=require("three-stdlib"),n=require("three");function u(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var c=u(r);function a(e,r=16,u,a,i){const[o,l]=c.useState((()=>{const e=Array.from({length:r},(()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])).flat();return new n.InstancedBufferAttribute(Float32Array.from(e),16)}));return c.useLayoutEffect((()=>{if(void 0===e.current)return;const c=new t.MeshSurfaceSampler(e.current);a&&c.setWeightAttribute(a),c.build();const s=new n.Vector3,f=new n.Vector3,d=new n.Color,p=new n.Object3D;e.current.updateMatrixWorld(!0);for(let t=0;t<r;t++)c.sample(s,f,d),"function"==typeof u?u({dummy:p,sampledMesh:e.current,position:s,normal:f,color:d},t):p.position.copy(s),p.updateMatrix(),null!=i&&i.current&&i.current.setMatrixAt(t,p.matrix),p.matrix.toArray(o.array,16*t);null!=i&&i.current&&(i.current.instanceMatrix.needsUpdate=!0),o.needsUpdate=!0,l(new n.InstancedBufferAttribute(o.array,o.itemSize).copy(o))}),[e,i,a,r,u]),o}exports.Sampler=function({children:r,weight:t,transform:n,instances:u,mesh:i,count:o=16,...l}){const s=c.useRef(null),f=c.useRef(null),d=c.useRef(null);return c.useLayoutEffect((()=>{var e,r;f.current=null!==(e=null==u?void 0:u.current)&&void 0!==e?e:s.current.children.find((e=>e.hasOwnProperty("instanceMatrix"))),d.current=null!==(r=null==i?void 0:i.current)&&void 0!==r?r:s.current.children.find((e=>"Mesh"===e.type))}),[r,null==i?void 0:i.current,null==u?void 0:u.current]),a(d,o,n,t,f),c.createElement("group",e({ref:s},l),r)},exports.useSurfaceSampler=a;
