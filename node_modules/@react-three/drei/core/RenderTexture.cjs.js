"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("three"),t=require("react"),n=require("@react-three/fiber"),a=require("./Fbo.cjs.js");function i(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var l=i(r),s=i(t);const u=s.forwardRef((({children:r,compute:t,width:i,height:u,samples:o=8,renderPriority:f=0,eventPriority:g=0,frames:d=1/0,stencilBuffer:m=!1,depthBuffer:p=!0,generateMipmaps:b=!1,...v},h)=>{const{size:x,viewport:y}=n.useThree(),P=a.useFBO((i||x.width)*y.dpr,(u||x.height)*y.dpr,{samples:o,stencilBuffer:m,depthBuffer:p,generateMipmaps:b}),[j]=s.useState((()=>new l.Scene)),O=s.useCallback(((e,r,t)=>{var n,a;let i=null==(n=P.texture)?void 0:n.__r3f.parent;for(;i&&!(i instanceof l.Object3D);)i=i.__r3f.parent;if(!i)return!1;t.raycaster.camera||t.events.compute(e,t,null==(a=t.previousRoot)?void 0:a.getState());const[s]=t.raycaster.intersectObject(i);if(!s)return!1;const u=s.uv;if(!u)return!1;r.raycaster.setFromCamera(r.pointer.set(2*u.x-1,2*u.y-1),r.camera)}),[]);return s.useImperativeHandle(h,(()=>P.texture),[P]),s.createElement(s.Fragment,null,n.createPortal(s.createElement(c,{renderPriority:f,frames:d,fbo:P},r,s.createElement("group",{onPointerOver:()=>null})),j,{events:{compute:t||O,priority:g}}),s.createElement("primitive",e({object:P.texture},v)))}));function c({frames:e,renderPriority:r,children:t,fbo:a}){let i,l,u,c,o=0;return n.useFrame((r=>{(e===1/0||o<e)&&(i=r.gl.autoClear,l=r.gl.xr.enabled,u=r.gl.getRenderTarget(),c=r.gl.xr.isPresenting,r.gl.autoClear=!0,r.gl.xr.enabled=!1,r.gl.xr.isPresenting=!1,r.gl.setRenderTarget(a),r.gl.render(r.scene,r.camera),r.gl.setRenderTarget(u),r.gl.autoClear=i,r.gl.xr.enabled=l,r.gl.xr.isPresenting=c,o++)}),r),s.createElement(s.Fragment,null,t)}exports.RenderTexture=u;
