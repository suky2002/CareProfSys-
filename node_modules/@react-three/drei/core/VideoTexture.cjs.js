"use strict";var e=require("react"),t=require("three"),n=require("@react-three/fiber"),r=require("suspend-react"),o=require("hls.js");function u(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var c,s,i=u(e),l=u(t);const a="undefined"!=typeof window&&"function"==typeof(null==(c=window.document)?void 0:c.createElement)&&"string"==typeof(null==(s=window.navigator)?void 0:s.userAgent);let d=null;function p(t,{unsuspend:u="loadedmetadata",start:c=!0,hls:s={},crossOrigin:i="anonymous",muted:p=!0,loop:f=!0,playsInline:g=!0,...m}={}){const y=n.useThree((e=>e.gl)),v=e.useRef(null),w=r.suspend((()=>new Promise((async e=>{let n,r;"string"==typeof t?n=t:r=t;const c=Object.assign(document.createElement("video"),{src:n,srcObject:r,crossOrigin:i,loop:f,muted:p,playsInline:g,...m});if(n&&a&&n.endsWith(".m3u8")){const e=v.current=await async function(...e){var t;null!==(t=d)&&void 0!==t||(d=await import("hls.js"));const n=d.default;return n.isSupported()?new n(...e):null}(s);e&&(e.on(o.Events.MEDIA_ATTACHED,(()=>{e.loadSource(n)})),e.attachMedia(c))}const w=new l.VideoTexture(c);"colorSpace"in w?w.colorSpace=y.outputColorSpace:w.encoding=y.outputEncoding,c.addEventListener(u,(()=>e(w)))}))),[t]);return e.useEffect((()=>(c&&w.image.play(),()=>{v.current&&(v.current.destroy(),v.current=null)})),[w,c]),w}exports.VideoTexture=({children:t,src:n,...r})=>{const o=p(n,r);return e.useEffect((()=>()=>{o.dispose()}),[o]),i.createElement(i.Fragment,null,null==t?void 0:t(o))},exports.useVideoTexture=p;
