"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("react"),t=require("@react-three/fiber"),n=require("./Fbo.cjs.js");function u(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("three");var c=u(r);const a=c.forwardRef((({envMap:r,resolution:u=256,frames:a=1/0,makeDefault:s,children:l,...i},o)=>{const f=t.useThree((({set:e})=>e)),m=t.useThree((({camera:e})=>e)),b=t.useThree((({size:e})=>e)),d=c.useRef(null);c.useImperativeHandle(o,(()=>d.current),[]);const g=c.useRef(null),p=n.useFBO(u);c.useLayoutEffect((()=>{i.manual||(d.current.aspect=b.width/b.height)}),[b,i]),c.useLayoutEffect((()=>{d.current.updateProjectionMatrix()}));let h=0,v=null;const j="function"==typeof l;return t.useFrame((e=>{j&&(a===1/0||h<a)&&(g.current.visible=!1,e.gl.setRenderTarget(p),v=e.scene.background,r&&(e.scene.background=r),e.gl.render(e.scene,d.current),e.scene.background=v,e.gl.setRenderTarget(null),g.current.visible=!0,h++)})),c.useLayoutEffect((()=>{if(s){const e=m;return f((()=>({camera:d.current}))),()=>f((()=>({camera:e})))}}),[d,s,f]),c.createElement(c.Fragment,null,c.createElement("perspectiveCamera",e({ref:d},i),!j&&l),c.createElement("group",{ref:g},j&&l(p.texture)))}));exports.PerspectiveCamera=a;
