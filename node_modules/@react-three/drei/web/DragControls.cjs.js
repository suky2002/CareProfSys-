"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("react"),t=require("three"),n=require("@react-three/fiber"),a=require("@use-gesture/react");function o(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var i=o(r),c=o(t);const s=new c.Vector3,u=new c.Vector2,l=new c.Vector3,m=new c.Vector3,x=new c.Vector3,d=new c.Plane,f=i.forwardRef((({autoTransform:r=!0,matrix:t,axisLock:o,dragLimits:f,onHover:p,onDragStart:y,onDrag:g,onDragEnd:h,children:b,dragConfig:v,...w},D)=>{const z=n.useThree((e=>e.controls)),{camera:M,size:P,raycaster:V,invalidate:j}=n.useThree(),O=i.useRef(null),q=a.useGesture({onHover:({hovering:e})=>p&&p(null!=e&&e),onDragStart:({event:e})=>{z&&(z.enabled=!1);const{point:r}=e;O.current.matrix.decompose(s,new c.Quaternion,new c.Vector3),l.copy(r),m.copy(l).sub(s),y&&y(s),j()},onDrag:({xy:[e,t],intentional:n})=>{if(!n)return;const a=(e-P.left)/P.width*2-1,i=-(t-P.top)/P.height*2+1;if(u.set(a,i),V.setFromCamera(u,M),o)switch(o){case"x":x.set(1,0,0);break;case"y":x.set(0,1,0);break;case"z":x.set(0,0,1)}else M.getWorldDirection(x).negate();d.setFromNormalAndCoplanarPoint(x,l),V.ray.intersectPlane(d,l);const s=O.current.matrix.clone(),p=O.current.matrixWorld.clone(),y=new c.Vector3(l.x-m.x,l.y-m.y,l.z-m.z);if(f&&(y.x=f[0]?Math.max(Math.min(y.x,f[0][1]),f[0][0]):y.x,y.y=f[1]?Math.max(Math.min(y.y,f[1][1]),f[1][0]):y.y,y.z=f[2]?Math.max(Math.min(y.z,f[2][1]),f[2][0]):y.z),r){O.current.matrix.setPosition(y);const e=O.current.matrix.clone().multiply(s.invert()),r=O.current.matrix.clone().multiply(p.invert());g&&g(O.current.matrix,e,O.current.matrixWorld,r)}else{const e=(new c.Matrix4).copy(O.current.matrix);e.setPosition(y);const r=e.clone().multiply(s.invert()),t=e.clone().multiply(p.invert());g&&g(e,r,O.current.matrixWorld,t)}j()},onDragEnd:()=>{z&&(z.enabled=!0),h&&h(),j()}},{drag:{filterTaps:!0,threshold:1,..."object"==typeof v?v:{}}});return i.useImperativeHandle(D,(()=>O.current),[]),i.useLayoutEffect((()=>{t&&(O.current.matrix=t)}),[t]),i.createElement("group",e({ref:O},q(),{matrix:t,matrixAutoUpdate:!1},w),b)}));exports.DragControls=f;
