"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("@react-three/fiber"),t=require("react"),i=require("three"),a=require("./AxisArrow.cjs.js"),n=require("./AxisRotator.cjs.js"),o=require("./PlaneSlider.cjs.js"),c=require("./ScalingSphere.cjs.js"),s=require("./context.cjs.js"),l=require("../../core/calculateScaleFactor.cjs.js");function u(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("../../core/Line.cjs.js"),require("three-stdlib"),require("../Html.cjs.js"),require("react-dom/client");var d=u(t),m=u(i);const x=new m.Matrix4,p=new m.Matrix4,f=new m.Matrix4,y=new m.Matrix4,w=new m.Matrix4,g=new m.Matrix4,E=new m.Matrix4,b=new m.Matrix4,S=new m.Matrix4,h=new m.Box3,j=new m.Box3,v=new m.Vector3,M=new m.Vector3,A=new m.Vector3,q=new m.Vector3,R=new m.Vector3,V=new m.Vector3(1,0,0),P=new m.Vector3(0,1,0),W=new m.Vector3(0,0,1),D=d.forwardRef((({enabled:t=!0,matrix:i,onDragStart:u,onDrag:D,onDragEnd:C,autoTransform:L=!0,anchor:B,disableAxes:F=!1,disableSliders:O=!1,disableRotations:z=!1,disableScaling:T=!1,activeAxes:k=[!0,!0,!0],offset:H=[0,0,0],rotation:I=[0,0,0],scale:U=1,lineWidth:G=4,fixed:J=!1,translationLimits:K,rotationLimits:N,scaleLimits:Q,depthTest:X=!0,axisColors:Y=["#ff2060","#20df80","#2080ff"],hoveredColor:Z="#ffff40",annotations:$=!1,annotationsClass:_,opacity:ee=1,visible:re=!0,userData:te,children:ie,...ae},ne)=>{const oe=r.useThree((e=>e.invalidate)),ce=d.useRef(null),se=d.useRef(null),le=d.useRef(null),ue=d.useRef(null),de=d.useRef([0,0,0]),me=d.useRef(new m.Vector3(1,1,1)),xe=d.useRef(new m.Vector3(1,1,1));d.useLayoutEffect((()=>{B&&(ue.current.updateWorldMatrix(!0,!0),y.copy(ue.current.matrixWorld).invert(),h.makeEmpty(),ue.current.traverse((e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),g.copy(e.matrixWorld).premultiply(y),j.copy(e.geometry.boundingBox),j.applyMatrix4(g),h.union(j))})),v.copy(h.max).add(h.min).multiplyScalar(.5),M.copy(h.max).sub(h.min).multiplyScalar(.5),A.copy(M).multiply(new m.Vector3(...B)).add(v),q.set(...H).add(A),le.current.position.copy(q),oe())}));const pe=d.useMemo((()=>({onDragStart:e=>{x.copy(se.current.matrix),p.copy(se.current.matrixWorld),u&&u(e),oe()},onDrag:e=>{f.copy(ce.current.matrixWorld),y.copy(f).invert(),w.copy(p).premultiply(e),g.copy(w).premultiply(y),E.copy(x).invert(),b.copy(g).multiply(E),L&&se.current.matrix.copy(g),D&&D(g,b,w,e),oe()},onDragEnd:()=>{C&&C(),oe()},translation:de,translationLimits:K,rotationLimits:N,axisColors:Y,hoveredColor:Z,opacity:ee,scale:U,lineWidth:G,fixed:J,depthTest:X,userData:te,annotations:$,annotationsClass:_})),[u,D,C,de,K,N,Q,X,U,G,J,...Y,Z,ee,te,L,$,_]),fe=new m.Vector3;return r.useFrame((e=>{if(J){const r=l.calculateScaleFactor(le.current.getWorldPosition(fe),U,e.camera,e.size);me.current.setScalar(r)}i&&i instanceof m.Matrix4&&(se.current.matrix=i),se.current.updateWorldMatrix(!0,!0),S.makeRotationFromEuler(le.current.rotation).setPosition(le.current.position).premultiply(se.current.matrixWorld),xe.current.setFromMatrixScale(S),R.copy(me.current).divide(xe.current),(Math.abs(le.current.scale.x-R.x)>1e-4||Math.abs(le.current.scale.y-R.y)>1e-4||Math.abs(le.current.scale.z-R.z)>1e-4)&&(le.current.scale.copy(R),e.invalidate())})),d.useImperativeHandle(ne,(()=>se.current),[]),d.createElement(s.context.Provider,{value:pe},d.createElement("group",{ref:ce},d.createElement("group",e({ref:se,matrix:i,matrixAutoUpdate:!1},ae),d.createElement("group",{visible:re,ref:le,position:H,rotation:I},t&&d.createElement(d.Fragment,null,!F&&k[0]&&d.createElement(a.AxisArrow,{axis:0,direction:V}),!F&&k[1]&&d.createElement(a.AxisArrow,{axis:1,direction:P}),!F&&k[2]&&d.createElement(a.AxisArrow,{axis:2,direction:W}),!O&&k[0]&&k[1]&&d.createElement(o.PlaneSlider,{axis:2,dir1:V,dir2:P}),!O&&k[0]&&k[2]&&d.createElement(o.PlaneSlider,{axis:1,dir1:W,dir2:V}),!O&&k[2]&&k[1]&&d.createElement(o.PlaneSlider,{axis:0,dir1:P,dir2:W}),!z&&k[0]&&k[1]&&d.createElement(n.AxisRotator,{axis:2,dir1:V,dir2:P}),!z&&k[0]&&k[2]&&d.createElement(n.AxisRotator,{axis:1,dir1:W,dir2:V}),!z&&k[2]&&k[1]&&d.createElement(n.AxisRotator,{axis:0,dir1:P,dir2:W}),!T&&k[0]&&d.createElement(c.ScalingSphere,{axis:0,direction:V}),!T&&k[1]&&d.createElement(c.ScalingSphere,{axis:1,direction:P}),!T&&k[2]&&d.createElement(c.ScalingSphere,{axis:2,direction:W}))),d.createElement("group",{ref:ue},ie))))}));exports.PivotControls=D;
