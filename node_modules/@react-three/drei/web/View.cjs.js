"use strict";var e=require("@babel/runtime/helpers/extends"),t=require("react"),r=require("three"),n=require("@react-three/fiber"),c=require("tunnel-rat");function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var a=i(t),o=i(r);const s=new o.Color,l=c();function u(e){return"top"in e}function f(e,t){const{right:r,top:n,left:c,bottom:i,width:a,height:o}=t,s=t.bottom<0||n>e.height||r<0||t.left>e.width;if(u(e)){const t=e.top+e.height-i;return{position:{width:a,height:o,left:c-e.left,top:n,bottom:t,right:r},isOffscreen:s}}return{position:{width:a,height:o,top:n,left:c,bottom:e.height-i,right:r},isOffscreen:s}}function m(e,{left:t,bottom:r,width:n,height:c}){let i;const a=n/c;var o;return(o=e.camera)&&o.isOrthographicCamera?e.camera.left===n/-2&&e.camera.right===n/2&&e.camera.top===c/2&&e.camera.bottom===c/-2||(Object.assign(e.camera,{left:n/-2,right:n/2,top:c/2,bottom:c/-2}),e.camera.updateProjectionMatrix()):e.camera.aspect!==a&&(e.camera.aspect=a,e.camera.updateProjectionMatrix()),i=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,r,n,c),e.gl.setScissor(t,r,n,c),e.gl.setScissorTest(!0),i}function d(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function h(e){e.gl.getClearColor(s),e.gl.setClearColor(s,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function g({visible:e=!0,canvasSize:t,scene:r,index:c,children:i,frames:o,rect:s,track:l}){const g=n.useThree(),[p,v]=a.useState(!1);let b=0;return n.useFrame((n=>{var c;(o===1/0||b<=o)&&(l&&(s.current=null==(c=l.current)?void 0:c.getBoundingClientRect()),b++);if(s.current){const{position:c,isOffscreen:a}=f(t,s.current);if(p!==a&&v(a),e&&!p&&s.current){const e=m(n,c);n.gl.render(i?n.scene:r,n.camera),d(n,e)}}}),c),a.useLayoutEffect((()=>{const r=s.current;if(r&&(!e||!p)){const{position:e}=f(t,r),n=m(g,e);h(g),d(g,n)}}),[e,p]),a.useEffect((()=>{if(!l)return;const e=s.current,r=g.get().events.connected;return g.setEvents({connected:l.current}),()=>{if(e){const{position:r}=f(t,e),n=m(g,r);h(g),d(g,n)}g.setEvents({connected:r})}}),[l]),a.useEffect((()=>{u(t)||console.warn("Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.\n See https://github.com/pmndrs/drei/issues/944")}),[]),a.createElement(a.Fragment,null,i,a.createElement("group",{onPointerOver:()=>null}))}const p=a.forwardRef((({track:t,visible:r=!0,index:c=1,id:i,style:s,className:l,frames:u=1/0,children:f,...m},d)=>{var h,p,v,b;const w=a.useRef(null),{size:E,scene:C}=n.useThree(),[O]=a.useState((()=>new o.Scene)),[x,y]=a.useReducer((()=>!0),!1),k=a.useCallback(((e,r)=>{if(w.current&&t&&t.current&&e.target===t.current){const{width:t,height:n,left:c,top:i}=w.current,a=e.clientX-c,o=e.clientY-i;r.pointer.set(a/t*2-1,-o/n*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)}}),[w,t]);return a.useEffect((()=>{var e;t&&(w.current=null==(e=t.current)?void 0:e.getBoundingClientRect()),y()}),[t]),a.createElement("group",e({ref:d},m),x&&n.createPortal(a.createElement(g,{visible:r,canvasSize:E,frames:u,scene:C,track:t,rect:w,index:c},f),O,{events:{compute:k,priority:c},size:{width:null==(h=w.current)?void 0:h.width,height:null==(p=w.current)?void 0:p.height,top:null==(v=w.current)?void 0:v.top,left:null==(b=w.current)?void 0:b.left}}))})),v=a.forwardRef((({as:t="div",id:r,visible:n,className:c,style:i,index:o=1,track:s,frames:u=1/0,children:f,...m},d)=>{const h=a.useId(),g=a.useRef(null);return a.useImperativeHandle(d,(()=>g.current)),a.createElement(a.Fragment,null,a.createElement(t,e({ref:g,id:r,className:c,style:i},m)),a.createElement(l.In,null,a.createElement(p,{visible:n,key:h,track:g,frames:u,index:o},f)))})),b=a.forwardRef(((t,r)=>a.useContext(n.context)?a.createElement(p,e({ref:r},t)):a.createElement(v,e({ref:r},t))));b.Port=()=>a.createElement(l.Out,null),exports.View=b;
