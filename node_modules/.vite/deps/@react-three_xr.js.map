{
  "version": 3,
  "sources": ["../../three/examples/jsm/loaders/GLTFLoader.js", "../../three/examples/jsm/libs/motion-controllers.module.js", "../../three/examples/jsm/webxr/XRControllerModelFactory.js", "../../@react-three/xr/dist/index.js", "../../three/examples/jsm/webxr/ARButton.js", "../../three/examples/jsm/webxr/VRButton.js", "../../react-merge-refs/src/index.tsx", "../../three/examples/jsm/webxr/XRHandPrimitiveModel.js", "../../three/examples/jsm/webxr/XRHandMeshModel.js", "../../three/examples/jsm/webxr/XRHandModelFactory.js"],
  "sourcesContent": ["import {\r\n\tAnimationClip,\r\n\tBone,\r\n\tBox3,\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tDoubleSide,\r\n\tFileLoader,\r\n\tFrontSide,\r\n\tGroup,\r\n\tImageBitmapLoader,\r\n\tInterleavedBuffer,\r\n\tInterleavedBufferAttribute,\r\n\tInterpolant,\r\n\tInterpolateDiscrete,\r\n\tInterpolateLinear,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLineLoop,\r\n\tLineSegments,\r\n\tLinearFilter,\r\n\tLinearMipmapLinearFilter,\r\n\tLinearMipmapNearestFilter,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMaterial,\r\n\tMathUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tMeshPhysicalMaterial,\r\n\tMeshStandardMaterial,\r\n\tMirroredRepeatWrapping,\r\n\tNearestFilter,\r\n\tNearestMipmapLinearFilter,\r\n\tNearestMipmapNearestFilter,\r\n\tNumberKeyframeTrack,\r\n\tObject3D,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tPoints,\r\n\tPointsMaterial,\r\n\tPropertyBinding,\r\n\tQuaternion,\r\n\tQuaternionKeyframeTrack,\r\n\tRepeatWrapping,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSphere,\r\n\tSpotLight,\r\n\tTangentSpaceNormalMap,\r\n\tTexture,\r\n\tTextureLoader,\r\n\tTriangleFanDrawMode,\r\n\tTriangleStripDrawMode,\r\n\tVector2,\r\n\tVector3,\r\n\tVectorKeyframeTrack,\r\n\tsRGBEncoding\r\n} from 'three';\r\n\r\nclass GLTFLoader extends Loader {\r\n\r\n\tconstructor( manager ) {\r\n\r\n\t\tsuper( manager );\r\n\r\n\t\tthis.dracoLoader = null;\r\n\t\tthis.ktx2Loader = null;\r\n\t\tthis.meshoptDecoder = null;\r\n\r\n\t\tthis.pluginCallbacks = [];\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFTextureWebPExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFLightsExtension( parser );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.register( function ( parser ) {\r\n\r\n\t\t\treturn new GLTFMeshoptCompression( parser );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tload( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\tlet resourcePath;\r\n\r\n\t\tif ( this.resourcePath !== '' ) {\r\n\r\n\t\t\tresourcePath = this.resourcePath;\r\n\r\n\t\t} else if ( this.path !== '' ) {\r\n\r\n\t\t\tresourcePath = this.path;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\r\n\r\n\t\t}\r\n\r\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\r\n\t\t// the model is fully loaded. This means the count of items loaded will\r\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\r\n\t\tthis.manager.itemStart( url );\r\n\r\n\t\tconst _onError = function ( e ) {\r\n\r\n\t\t\tif ( onError ) {\r\n\r\n\t\t\t\tonError( e );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscope.manager.itemError( url );\r\n\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t};\r\n\r\n\t\tconst loader = new FileLoader( this.manager );\r\n\r\n\t\tloader.setPath( this.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( this.requestHeader );\r\n\t\tloader.setWithCredentials( this.withCredentials );\r\n\r\n\t\tloader.load( url, function ( data ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\r\n\r\n\t\t\t\t\tonLoad( gltf );\r\n\r\n\t\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t\t}, _onError );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t_onError( e );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, _onError );\r\n\r\n\t}\r\n\r\n\tsetDRACOLoader( dracoLoader ) {\r\n\r\n\t\tthis.dracoLoader = dracoLoader;\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetDDSLoader() {\r\n\r\n\t\tthrow new Error(\r\n\r\n\t\t\t'THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".'\r\n\r\n\t\t);\r\n\r\n\t}\r\n\r\n\tsetKTX2Loader( ktx2Loader ) {\r\n\r\n\t\tthis.ktx2Loader = ktx2Loader;\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetMeshoptDecoder( meshoptDecoder ) {\r\n\r\n\t\tthis.meshoptDecoder = meshoptDecoder;\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tregister( callback ) {\r\n\r\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\r\n\r\n\t\t\tthis.pluginCallbacks.push( callback );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tunregister( callback ) {\r\n\r\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\r\n\r\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tparse( data, path, onLoad, onError ) {\r\n\r\n\t\tlet content;\r\n\t\tconst extensions = {};\r\n\t\tconst plugins = {};\r\n\r\n\t\tif ( typeof data === 'string' ) {\r\n\r\n\t\t\tcontent = data;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\r\n\r\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\r\n\r\n\t\t\t\t} catch ( error ) {\r\n\r\n\t\t\t\t\tif ( onError ) onError( error );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst json = JSON.parse( content );\r\n\r\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\r\n\r\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst parser = new GLTFParser( json, {\r\n\r\n\t\t\tpath: path || this.resourcePath || '',\r\n\t\t\tcrossOrigin: this.crossOrigin,\r\n\t\t\trequestHeader: this.requestHeader,\r\n\t\t\tmanager: this.manager,\r\n\t\t\tktx2Loader: this.ktx2Loader,\r\n\t\t\tmeshoptDecoder: this.meshoptDecoder\r\n\r\n\t\t} );\r\n\r\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\r\n\r\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\r\n\r\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\r\n\t\t\tplugins[ plugin.name ] = plugin;\r\n\r\n\t\t\t// Workaround to avoid determining as unknown extension\r\n\t\t\t// in addUnknownExtensionsToUserData().\r\n\t\t\t// Remove this workaround if we move all the existing\r\n\t\t\t// extension handlers to plugin system\r\n\t\t\textensions[ plugin.name ] = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( json.extensionsUsed ) {\r\n\r\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\r\n\r\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\r\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\r\n\r\n\t\t\t\tswitch ( extensionName ) {\r\n\r\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\r\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\r\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\r\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\r\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\r\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tparser.setExtensions( extensions );\r\n\t\tparser.setPlugins( plugins );\r\n\t\tparser.parse( onLoad, onError );\r\n\r\n\t}\r\n\r\n\tparseAsync( data, path ) {\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\tscope.parse( data, path, resolve, reject );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/* GLTFREGISTRY */\r\n\r\nfunction GLTFRegistry() {\r\n\r\n\tlet objects = {};\r\n\r\n\treturn\t{\r\n\r\n\t\tget: function ( key ) {\r\n\r\n\t\t\treturn objects[ key ];\r\n\r\n\t\t},\r\n\r\n\t\tadd: function ( key, object ) {\r\n\r\n\t\t\tobjects[ key ] = object;\r\n\r\n\t\t},\r\n\r\n\t\tremove: function ( key ) {\r\n\r\n\t\t\tdelete objects[ key ];\r\n\r\n\t\t},\r\n\r\n\t\tremoveAll: function () {\r\n\r\n\t\t\tobjects = {};\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\n/*********************************/\r\n/********** EXTENSIONS ***********/\r\n/*********************************/\r\n\r\nconst EXTENSIONS = {\r\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\r\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\r\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\r\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\r\n\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\r\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\r\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\r\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\r\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\r\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\r\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\r\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\r\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\r\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\r\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression'\r\n};\r\n\r\n/**\r\n * Punctual Lights Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\r\n */\r\nclass GLTFLightsExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\r\n\r\n\t\t// Object3D instance caches\r\n\t\tthis.cache = { refs: {}, uses: {} };\r\n\r\n\t}\r\n\r\n\t_markDefs() {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst nodeDefs = this.parser.json.nodes || [];\r\n\r\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.extensions\r\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\r\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\r\n\r\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t_loadLight( lightIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst cacheKey = 'light:' + lightIndex;\r\n\t\tlet dependency = parser.cache.get( cacheKey );\r\n\r\n\t\tif ( dependency ) return dependency;\r\n\r\n\t\tconst json = parser.json;\r\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\r\n\t\tconst lightDefs = extensions.lights || [];\r\n\t\tconst lightDef = lightDefs[ lightIndex ];\r\n\t\tlet lightNode;\r\n\r\n\t\tconst color = new Color( 0xffffff );\r\n\r\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\r\n\r\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\r\n\r\n\t\tswitch ( lightDef.type ) {\r\n\r\n\t\t\tcase 'directional':\r\n\t\t\t\tlightNode = new DirectionalLight( color );\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'point':\r\n\t\t\t\tlightNode = new PointLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'spot':\r\n\t\t\t\tlightNode = new SpotLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\t// Handle spotlight properties.\r\n\t\t\t\tlightDef.spot = lightDef.spot || {};\r\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\r\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\r\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\r\n\r\n\t\t}\r\n\r\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\r\n\t\t// here, because node-level parsing will only override position if explicitly specified.\r\n\t\tlightNode.position.set( 0, 0, 0 );\r\n\r\n\t\tlightNode.decay = 2;\r\n\r\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\r\n\r\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\r\n\r\n\t\tdependency = Promise.resolve( lightNode );\r\n\r\n\t\tparser.cache.add( cacheKey, dependency );\r\n\r\n\t\treturn dependency;\r\n\r\n\t}\r\n\r\n\tcreateNodeAttachment( nodeIndex ) {\r\n\r\n\t\tconst self = this;\r\n\t\tconst parser = this.parser;\r\n\t\tconst json = parser.json;\r\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\r\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\r\n\t\tconst lightIndex = lightDef.light;\r\n\r\n\t\tif ( lightIndex === undefined ) return null;\r\n\r\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\r\n\r\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Unlit Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\r\n */\r\nclass GLTFMaterialsUnlitExtension {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\r\n\r\n\t}\r\n\r\n\tgetMaterialType() {\r\n\r\n\t\treturn MeshBasicMaterial;\r\n\r\n\t}\r\n\r\n\textendParams( materialParams, materialDef, parser ) {\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n\t\tif ( metallicRoughness ) {\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, sRGBEncoding ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Clearcoat Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\r\n */\r\nclass GLTFMaterialsClearcoatExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\r\n\r\n\t}\r\n\r\n\tgetMaterialType( materialIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t}\r\n\r\n\textendMaterialParams( materialIndex, materialParams ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tconst extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tif ( extension.clearcoatFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\r\n\r\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\r\n\r\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Sheen Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\r\n */\r\nclass GLTFMaterialsSheenExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\r\n\r\n\t}\r\n\r\n\tgetMaterialType( materialIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t}\r\n\r\n\textendMaterialParams( materialIndex, materialParams ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\r\n\t\tmaterialParams.sheenRoughness = 0;\r\n\t\tmaterialParams.sheen = 1;\r\n\r\n\t\tconst extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tif ( extension.sheenColorFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.sheenColor.fromArray( extension.sheenColorFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.sheenColorTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, sRGBEncoding ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Transmission Materials Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\r\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\r\n */\r\nclass GLTFMaterialsTransmissionExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\r\n\r\n\t}\r\n\r\n\tgetMaterialType( materialIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t}\r\n\r\n\textendMaterialParams( materialIndex, materialParams ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tconst extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tif ( extension.transmissionFactor !== undefined ) {\r\n\r\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension.transmissionTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Materials Volume Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\r\n */\r\nclass GLTFMaterialsVolumeExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\r\n\r\n\t}\r\n\r\n\tgetMaterialType( materialIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t}\r\n\r\n\textendMaterialParams( materialIndex, materialParams ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tconst extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\r\n\r\n\t\tif ( extension.thicknessTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || 0;\r\n\r\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\r\n\t\tmaterialParams.attenuationColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Materials ior Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\r\n */\r\nclass GLTFMaterialsIorExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\r\n\r\n\t}\r\n\r\n\tgetMaterialType( materialIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t}\r\n\r\n\textendMaterialParams( materialIndex, materialParams ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tconst extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\r\n\r\n\t\treturn Promise.resolve();\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Materials specular Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\r\n */\r\nclass GLTFMaterialsSpecularExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\r\n\r\n\t}\r\n\r\n\tgetMaterialType( materialIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\r\n\r\n\t\treturn MeshPhysicalMaterial;\r\n\r\n\t}\r\n\r\n\textendMaterialParams( materialIndex, materialParams ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\r\n\r\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn Promise.resolve();\r\n\r\n\t\t}\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tconst extension = materialDef.extensions[ this.name ];\r\n\r\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\r\n\r\n\t\tif ( extension.specularTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\r\n\t\tmaterialParams.specularColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\r\n\r\n\t\tif ( extension.specularColorTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, sRGBEncoding ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * BasisU Texture Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\r\n */\r\nclass GLTFTextureBasisUExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\r\n\r\n\t}\r\n\r\n\tloadTexture( textureIndex ) {\r\n\r\n\t\tconst parser = this.parser;\r\n\t\tconst json = parser.json;\r\n\r\n\t\tconst textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tconst extension = textureDef.extensions[ this.name ];\r\n\t\tconst loader = parser.options.ktx2Loader;\r\n\r\n\t\tif ( ! loader ) {\r\n\r\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * WebP Texture Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\r\n */\r\nclass GLTFTextureWebPExtension {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.parser = parser;\r\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\r\n\t\tthis.isSupported = null;\r\n\r\n\t}\r\n\r\n\tloadTexture( textureIndex ) {\r\n\r\n\t\tconst name = this.name;\r\n\t\tconst parser = this.parser;\r\n\t\tconst json = parser.json;\r\n\r\n\t\tconst textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tconst extension = textureDef.extensions[ name ];\r\n\t\tconst source = json.images[ extension.source ];\r\n\r\n\t\tlet loader = parser.textureLoader;\r\n\t\tif ( source.uri ) {\r\n\r\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\r\n\t\t\tif ( handler !== null ) loader = handler;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.detectSupport().then( function ( isSupported ) {\r\n\r\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\r\n\r\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Fall back to PNG or JPEG.\r\n\t\t\treturn parser.loadTexture( textureIndex );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tdetectSupport() {\r\n\r\n\t\tif ( ! this.isSupported ) {\r\n\r\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\r\n\r\n\t\t\t\tconst image = new Image();\r\n\r\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\r\n\t\t\t\t// WebP images, unfortunately.\r\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\r\n\r\n\t\t\t\timage.onload = image.onerror = function () {\r\n\r\n\t\t\t\t\tresolve( image.height === 1 );\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.isSupported;\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * meshopt BufferView Compression Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\r\n */\r\nclass GLTFMeshoptCompression {\r\n\r\n\tconstructor( parser ) {\r\n\r\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\r\n\t\tthis.parser = parser;\r\n\r\n\t}\r\n\r\n\tloadBufferView( index ) {\r\n\r\n\t\tconst json = this.parser.json;\r\n\t\tconst bufferView = json.bufferViews[ index ];\r\n\r\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\r\n\r\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\r\n\r\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\r\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\r\n\r\n\t\t\tif ( ! decoder || ! decoder.supported ) {\r\n\r\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\r\n\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( [ buffer, decoder.ready ] ).then( function ( res ) {\r\n\r\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\r\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\r\n\r\n\t\t\t\tconst count = extensionDef.count;\r\n\t\t\t\tconst stride = extensionDef.byteStride;\r\n\r\n\t\t\t\tconst result = new ArrayBuffer( count * stride );\r\n\t\t\t\tconst source = new Uint8Array( res[ 0 ], byteOffset, byteLength );\r\n\r\n\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\r\n\t\t\t\treturn result;\r\n\r\n\t\t\t} );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n/* BINARY EXTENSION */\r\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\r\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\r\n\r\nclass GLTFBinaryExtension {\r\n\r\n\tconstructor( data ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n\t\tthis.content = null;\r\n\t\tthis.body = null;\r\n\r\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\r\n\r\n\t\tthis.header = {\r\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\r\n\t\t\tversion: headerView.getUint32( 4, true ),\r\n\t\t\tlength: headerView.getUint32( 8, true )\r\n\t\t};\r\n\r\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\r\n\r\n\t\t} else if ( this.header.version < 2.0 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\r\n\r\n\t\t}\r\n\r\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\r\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\r\n\t\tlet chunkIndex = 0;\r\n\r\n\t\twhile ( chunkIndex < chunkContentsLength ) {\r\n\r\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\r\n\r\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\r\n\t\t\t\tthis.content = LoaderUtils.decodeText( contentArray );\r\n\r\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\r\n\r\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Clients must ignore chunks with unknown types.\r\n\r\n\t\t\tchunkIndex += chunkLength;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.content === null ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * DRACO Mesh Compression Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\r\n */\r\nclass GLTFDracoMeshCompressionExtension {\r\n\r\n\tconstructor( json, dracoLoader ) {\r\n\r\n\t\tif ( ! dracoLoader ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\r\n\t\tthis.json = json;\r\n\t\tthis.dracoLoader = dracoLoader;\r\n\t\tthis.dracoLoader.preload();\r\n\r\n\t}\r\n\r\n\tdecodePrimitive( primitive, parser ) {\r\n\r\n\t\tconst json = this.json;\r\n\t\tconst dracoLoader = this.dracoLoader;\r\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\r\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\r\n\t\tconst threeAttributeMap = {};\r\n\t\tconst attributeNormalizedMap = {};\r\n\t\tconst attributeTypeMap = {};\r\n\r\n\t\tfor ( const attributeName in gltfAttributeMap ) {\r\n\r\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( const attributeName in primitive.attributes ) {\r\n\r\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\r\n\r\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\r\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType;\r\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\r\n\r\n\t\t\treturn new Promise( function ( resolve ) {\r\n\r\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\r\n\r\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\r\n\r\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\r\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\r\n\r\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresolve( geometry );\r\n\r\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Texture Transform Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\r\n */\r\nclass GLTFTextureTransformExtension {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\r\n\r\n\t}\r\n\r\n\textendTexture( texture, transform ) {\r\n\r\n\t\tif ( transform.texCoord !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.offset === undefined && transform.rotation === undefined && transform.scale === undefined ) {\r\n\r\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\r\n\t\t\treturn texture;\r\n\r\n\t\t}\r\n\r\n\t\ttexture = texture.clone();\r\n\r\n\t\tif ( transform.offset !== undefined ) {\r\n\r\n\t\t\ttexture.offset.fromArray( transform.offset );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.rotation !== undefined ) {\r\n\r\n\t\t\ttexture.rotation = transform.rotation;\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.scale !== undefined ) {\r\n\r\n\t\t\ttexture.repeat.fromArray( transform.scale );\r\n\r\n\t\t}\r\n\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Specular-Glossiness Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Archived/KHR_materials_pbrSpecularGlossiness\r\n */\r\n\r\n/**\r\n * A sub class of StandardMaterial with some of the functionality\r\n * changed via the `onBeforeCompile` callback\r\n * @pailhead\r\n */\r\nclass GLTFMeshStandardSGMaterial extends MeshStandardMaterial {\r\n\r\n\tconstructor( params ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t//various chunks that need replacing\r\n\t\tconst specularMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tuniform sampler2D specularMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tconst glossinessMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tuniform sampler2D glossinessMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tconst specularMapFragmentChunk = [\r\n\t\t\t'vec3 specularFactor = specular;',\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tconst glossinessMapFragmentChunk = [\r\n\t\t\t'float glossinessFactor = glossiness;',\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tconst lightPhysicalFragmentChunk = [\r\n\t\t\t'PhysicalMaterial material;',\r\n\t\t\t'material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );',\r\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\r\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\r\n\t\t\t'material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.',\r\n\t\t\t'material.roughness += geometryRoughness;',\r\n\t\t\t'material.roughness = min( material.roughness, 1.0 );',\r\n\t\t\t'material.specularColor = specularFactor;',\r\n\t\t].join( '\\n' );\r\n\r\n\t\tconst uniforms = {\r\n\t\t\tspecular: { value: new Color().setHex( 0xffffff ) },\r\n\t\t\tglossiness: { value: 1 },\r\n\t\t\tspecularMap: { value: null },\r\n\t\t\tglossinessMap: { value: null }\r\n\t\t};\r\n\r\n\t\tthis._extraUniforms = uniforms;\r\n\r\n\t\tthis.onBeforeCompile = function ( shader ) {\r\n\r\n\t\t\tfor ( const uniformName in uniforms ) {\r\n\r\n\t\t\t\tshader.uniforms[ uniformName ] = uniforms[ uniformName ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tshader.fragmentShader = shader.fragmentShader\r\n\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\r\n\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\r\n\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\r\n\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\r\n\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\r\n\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\r\n\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\r\n\r\n\t\t};\r\n\r\n\t\tObject.defineProperties( this, {\r\n\r\n\t\t\tspecular: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.specular.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.specular.value = v;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tspecularMap: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.specularMap.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.specularMap.value = v;\r\n\r\n\t\t\t\t\tif ( v ) {\r\n\r\n\t\t\t\t\t\tthis.defines.USE_SPECULARMAP = ''; // USE_UV is set by the renderer for specular maps\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdelete this.defines.USE_SPECULARMAP;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tglossiness: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.glossiness.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.glossiness.value = v;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tglossinessMap: {\r\n\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\treturn uniforms.glossinessMap.value;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\tuniforms.glossinessMap.value = v;\r\n\r\n\t\t\t\t\tif ( v ) {\r\n\r\n\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\r\n\t\t\t\t\t\tthis.defines.USE_UV = '';\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\r\n\t\t\t\t\t\tdelete this.defines.USE_UV;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\r\n\t\tthis.setValues( params );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.specularMap = source.specularMap;\r\n\t\tthis.specular.copy( source.specular );\r\n\t\tthis.glossinessMap = source.glossinessMap;\r\n\t\tthis.glossiness = source.glossiness;\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nclass GLTFMaterialsPbrSpecularGlossinessExtension {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\r\n\r\n\t\tthis.specularGlossinessParams = [\r\n\t\t\t'color',\r\n\t\t\t'map',\r\n\t\t\t'lightMap',\r\n\t\t\t'lightMapIntensity',\r\n\t\t\t'aoMap',\r\n\t\t\t'aoMapIntensity',\r\n\t\t\t'emissive',\r\n\t\t\t'emissiveIntensity',\r\n\t\t\t'emissiveMap',\r\n\t\t\t'bumpMap',\r\n\t\t\t'bumpScale',\r\n\t\t\t'normalMap',\r\n\t\t\t'normalMapType',\r\n\t\t\t'displacementMap',\r\n\t\t\t'displacementScale',\r\n\t\t\t'displacementBias',\r\n\t\t\t'specularMap',\r\n\t\t\t'specular',\r\n\t\t\t'glossinessMap',\r\n\t\t\t'glossiness',\r\n\t\t\t'alphaMap',\r\n\t\t\t'envMap',\r\n\t\t\t'envMapIntensity'\r\n\t\t];\r\n\r\n\t}\r\n\r\n\tgetMaterialType() {\r\n\r\n\t\treturn GLTFMeshStandardSGMaterial;\r\n\r\n\t}\r\n\r\n\textendParams( materialParams, materialDef, parser ) {\r\n\r\n\t\tconst pbrSpecularGlossiness = materialDef.extensions[ this.name ];\r\n\r\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\r\n\r\n\t\t\tconst array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'map', pbrSpecularGlossiness.diffuseTexture, sRGBEncoding ) );\r\n\r\n\t\t}\r\n\r\n\t\tmaterialParams.emissive = new Color( 0.0, 0.0, 0.0 );\r\n\t\tmaterialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n\t\tmaterialParams.specular = new Color( 1.0, 1.0, 1.0 );\r\n\r\n\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\r\n\r\n\t\t\tmaterialParams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\r\n\r\n\t\t\tconst specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'glossinessMap', specGlossMapDef ) );\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', specGlossMapDef, sRGBEncoding ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n\tcreateMaterial( materialParams ) {\r\n\r\n\t\tconst material = new GLTFMeshStandardSGMaterial( materialParams );\r\n\t\tmaterial.fog = true;\r\n\r\n\t\tmaterial.color = materialParams.color;\r\n\r\n\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\r\n\r\n\t\tmaterial.lightMap = null;\r\n\t\tmaterial.lightMapIntensity = 1.0;\r\n\r\n\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\r\n\t\tmaterial.aoMapIntensity = 1.0;\r\n\r\n\t\tmaterial.emissive = materialParams.emissive;\r\n\t\tmaterial.emissiveIntensity = 1.0;\r\n\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\r\n\r\n\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\r\n\t\tmaterial.bumpScale = 1;\r\n\r\n\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\r\n\t\tmaterial.normalMapType = TangentSpaceNormalMap;\r\n\r\n\t\tif ( materialParams.normalScale ) material.normalScale = materialParams.normalScale;\r\n\r\n\t\tmaterial.displacementMap = null;\r\n\t\tmaterial.displacementScale = 1;\r\n\t\tmaterial.displacementBias = 0;\r\n\r\n\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\r\n\t\tmaterial.specular = materialParams.specular;\r\n\r\n\t\tmaterial.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\r\n\t\tmaterial.glossiness = materialParams.glossiness;\r\n\r\n\t\tmaterial.alphaMap = null;\r\n\r\n\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\r\n\t\tmaterial.envMapIntensity = 1.0;\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Mesh Quantization Extension\r\n *\r\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\r\n */\r\nclass GLTFMeshQuantizationExtension {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\r\n\r\n\t}\r\n\r\n}\r\n\r\n/*********************************/\r\n/********** INTERPOLATION ********/\r\n/*********************************/\r\n\r\n// Spline Interpolation\r\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\nclass GLTFCubicSplineInterpolant extends Interpolant {\r\n\r\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\r\n\r\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\r\n\r\n\t}\r\n\r\n\tcopySampleValue_( index ) {\r\n\r\n\t\t// Copies a sample value to the result buffer. See description of glTF\r\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\r\n\r\n\t\tconst result = this.resultBuffer,\r\n\t\t\tvalues = this.sampleValues,\r\n\t\t\tvalueSize = this.valueSize,\r\n\t\t\toffset = index * valueSize * 3 + valueSize;\r\n\r\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\r\n\r\n\t\t\tresult[ i ] = values[ offset + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n}\r\n\r\nGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\nGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\nGLTFCubicSplineInterpolant.prototype.interpolate_ = function ( i1, t0, t, t1 ) {\r\n\r\n\tconst result = this.resultBuffer;\r\n\tconst values = this.sampleValues;\r\n\tconst stride = this.valueSize;\r\n\r\n\tconst stride2 = stride * 2;\r\n\tconst stride3 = stride * 3;\r\n\r\n\tconst td = t1 - t0;\r\n\r\n\tconst p = ( t - t0 ) / td;\r\n\tconst pp = p * p;\r\n\tconst ppp = pp * p;\r\n\r\n\tconst offset1 = i1 * stride3;\r\n\tconst offset0 = offset1 - stride3;\r\n\r\n\tconst s2 = - 2 * ppp + 3 * pp;\r\n\tconst s3 = ppp - pp;\r\n\tconst s0 = 1 - s2;\r\n\tconst s1 = s3 - pp + p;\r\n\r\n\t// Layout of keyframe output values for CUBICSPLINE animations:\r\n\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\r\n\tfor ( let i = 0; i !== stride; i ++ ) {\r\n\r\n\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\r\n\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\r\n\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\r\n\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\r\n\r\n\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\r\n\r\n\t}\r\n\r\n\treturn result;\r\n\r\n};\r\n\r\nconst _q = new Quaternion();\r\n\r\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\r\n\r\n\tinterpolate_( i1, t0, t, t1 ) {\r\n\r\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\r\n\r\n\t\t_q.fromArray( result ).normalize().toArray( result );\r\n\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n/*********************************/\r\n/********** INTERNALS ************/\r\n/*********************************/\r\n\r\n/* CONSTANTS */\r\n\r\nconst WEBGL_CONSTANTS = {\r\n\tFLOAT: 5126,\r\n\t//FLOAT_MAT2: 35674,\r\n\tFLOAT_MAT3: 35675,\r\n\tFLOAT_MAT4: 35676,\r\n\tFLOAT_VEC2: 35664,\r\n\tFLOAT_VEC3: 35665,\r\n\tFLOAT_VEC4: 35666,\r\n\tLINEAR: 9729,\r\n\tREPEAT: 10497,\r\n\tSAMPLER_2D: 35678,\r\n\tPOINTS: 0,\r\n\tLINES: 1,\r\n\tLINE_LOOP: 2,\r\n\tLINE_STRIP: 3,\r\n\tTRIANGLES: 4,\r\n\tTRIANGLE_STRIP: 5,\r\n\tTRIANGLE_FAN: 6,\r\n\tUNSIGNED_BYTE: 5121,\r\n\tUNSIGNED_SHORT: 5123\r\n};\r\n\r\nconst WEBGL_COMPONENT_TYPES = {\r\n\t5120: Int8Array,\r\n\t5121: Uint8Array,\r\n\t5122: Int16Array,\r\n\t5123: Uint16Array,\r\n\t5125: Uint32Array,\r\n\t5126: Float32Array\r\n};\r\n\r\nconst WEBGL_FILTERS = {\r\n\t9728: NearestFilter,\r\n\t9729: LinearFilter,\r\n\t9984: NearestMipmapNearestFilter,\r\n\t9985: LinearMipmapNearestFilter,\r\n\t9986: NearestMipmapLinearFilter,\r\n\t9987: LinearMipmapLinearFilter\r\n};\r\n\r\nconst WEBGL_WRAPPINGS = {\r\n\t33071: ClampToEdgeWrapping,\r\n\t33648: MirroredRepeatWrapping,\r\n\t10497: RepeatWrapping\r\n};\r\n\r\nconst WEBGL_TYPE_SIZES = {\r\n\t'SCALAR': 1,\r\n\t'VEC2': 2,\r\n\t'VEC3': 3,\r\n\t'VEC4': 4,\r\n\t'MAT2': 4,\r\n\t'MAT3': 9,\r\n\t'MAT4': 16\r\n};\r\n\r\nconst ATTRIBUTES = {\r\n\tPOSITION: 'position',\r\n\tNORMAL: 'normal',\r\n\tTANGENT: 'tangent',\r\n\tTEXCOORD_0: 'uv',\r\n\tTEXCOORD_1: 'uv2',\r\n\tCOLOR_0: 'color',\r\n\tWEIGHTS_0: 'skinWeight',\r\n\tJOINTS_0: 'skinIndex',\r\n};\r\n\r\nconst PATH_PROPERTIES = {\r\n\tscale: 'scale',\r\n\ttranslation: 'position',\r\n\trotation: 'quaternion',\r\n\tweights: 'morphTargetInfluences'\r\n};\r\n\r\nconst INTERPOLATION = {\r\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\r\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\r\n\tLINEAR: InterpolateLinear,\r\n\tSTEP: InterpolateDiscrete\r\n};\r\n\r\nconst ALPHA_MODES = {\r\n\tOPAQUE: 'OPAQUE',\r\n\tMASK: 'MASK',\r\n\tBLEND: 'BLEND'\r\n};\r\n\r\n/**\r\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n */\r\nfunction createDefaultMaterial( cache ) {\r\n\r\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\r\n\r\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\r\n\t\t\tcolor: 0xFFFFFF,\r\n\t\t\temissive: 0x000000,\r\n\t\t\tmetalness: 1,\r\n\t\t\troughness: 1,\r\n\t\t\ttransparent: false,\r\n\t\t\tdepthTest: true,\r\n\t\t\tside: FrontSide\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\treturn cache[ 'DefaultMaterial' ];\r\n\r\n}\r\n\r\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\r\n\r\n\t// Add unknown glTF extensions to an object's userData.\r\n\r\n\tfor ( const name in objectDef.extensions ) {\r\n\r\n\t\tif ( knownExtensions[ name ] === undefined ) {\r\n\r\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\r\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * @param {Object3D|Material|BufferGeometry} object\r\n * @param {GLTF.definition} gltfDef\r\n */\r\nfunction assignExtrasToUserData( object, gltfDef ) {\r\n\r\n\tif ( gltfDef.extras !== undefined ) {\r\n\r\n\t\tif ( typeof gltfDef.extras === 'object' ) {\r\n\r\n\t\t\tObject.assign( object.userData, gltfDef.extras );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n *\r\n * @param {BufferGeometry} geometry\r\n * @param {Array<GLTF.Target>} targets\r\n * @param {GLTFParser} parser\r\n * @return {Promise<BufferGeometry>}\r\n */\r\nfunction addMorphTargets( geometry, targets, parser ) {\r\n\r\n\tlet hasMorphPosition = false;\r\n\tlet hasMorphNormal = false;\r\n\tlet hasMorphColor = false;\r\n\r\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\tconst target = targets[ i ];\r\n\r\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\r\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\r\n\t\tif ( target.COLOR_0 !== undefined ) hasMorphColor = true;\r\n\r\n\t\tif ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;\r\n\r\n\t}\r\n\r\n\tif ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );\r\n\r\n\tconst pendingPositionAccessors = [];\r\n\tconst pendingNormalAccessors = [];\r\n\tconst pendingColorAccessors = [];\r\n\r\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\tconst target = targets[ i ];\r\n\r\n\t\tif ( hasMorphPosition ) {\r\n\r\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\r\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\r\n\t\t\t\t: geometry.attributes.position;\r\n\r\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( hasMorphNormal ) {\r\n\r\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\r\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\r\n\t\t\t\t: geometry.attributes.normal;\r\n\r\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( hasMorphColor ) {\r\n\r\n\t\t\tconst pendingAccessor = target.COLOR_0 !== undefined\r\n\t\t\t\t? parser.getDependency( 'accessor', target.COLOR_0 )\r\n\t\t\t\t: geometry.attributes.color;\r\n\r\n\t\t\tpendingColorAccessors.push( pendingAccessor );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn Promise.all( [\r\n\t\tPromise.all( pendingPositionAccessors ),\r\n\t\tPromise.all( pendingNormalAccessors ),\r\n\t\tPromise.all( pendingColorAccessors )\r\n\t] ).then( function ( accessors ) {\r\n\r\n\t\tconst morphPositions = accessors[ 0 ];\r\n\t\tconst morphNormals = accessors[ 1 ];\r\n\t\tconst morphColors = accessors[ 2 ];\r\n\r\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\r\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\r\n\t\tif ( hasMorphColor ) geometry.morphAttributes.color = morphColors;\r\n\t\tgeometry.morphTargetsRelative = true;\r\n\r\n\t\treturn geometry;\r\n\r\n\t} );\r\n\r\n}\r\n\r\n/**\r\n * @param {Mesh} mesh\r\n * @param {GLTF.Mesh} meshDef\r\n */\r\nfunction updateMorphTargets( mesh, meshDef ) {\r\n\r\n\tmesh.updateMorphTargets();\r\n\r\n\tif ( meshDef.weights !== undefined ) {\r\n\r\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\r\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\r\n\r\n\t\tconst targetNames = meshDef.extras.targetNames;\r\n\r\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\r\n\r\n\t\t\tmesh.morphTargetDictionary = {};\r\n\r\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction createPrimitiveKey( primitiveDef ) {\r\n\r\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\r\n\tlet geometryKey;\r\n\r\n\tif ( dracoExtension ) {\r\n\r\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\r\n\t\t\t\t+ ':' + dracoExtension.indices\r\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\r\n\r\n\t} else {\r\n\r\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\r\n\r\n\t}\r\n\r\n\treturn geometryKey;\r\n\r\n}\r\n\r\nfunction createAttributesKey( attributes ) {\r\n\r\n\tlet attributesKey = '';\r\n\r\n\tconst keys = Object.keys( attributes ).sort();\r\n\r\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\r\n\r\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\r\n\r\n\t}\r\n\r\n\treturn attributesKey;\r\n\r\n}\r\n\r\nfunction getNormalizedComponentScale( constructor ) {\r\n\r\n\t// Reference:\r\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\r\n\r\n\tswitch ( constructor ) {\r\n\r\n\t\tcase Int8Array:\r\n\t\t\treturn 1 / 127;\r\n\r\n\t\tcase Uint8Array:\r\n\t\t\treturn 1 / 255;\r\n\r\n\t\tcase Int16Array:\r\n\t\t\treturn 1 / 32767;\r\n\r\n\t\tcase Uint16Array:\r\n\t\t\treturn 1 / 65535;\r\n\r\n\t\tdefault:\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction getImageURIMimeType( uri ) {\r\n\r\n\tif ( uri.search( /\\.jpe?g($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/jpeg/ ) === 0 ) return 'image/jpeg';\r\n\tif ( uri.search( /\\.webp($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/webp/ ) === 0 ) return 'image/webp';\r\n\r\n\treturn 'image/png';\r\n\r\n}\r\n\r\n/* GLTF PARSER */\r\n\r\nclass GLTFParser {\r\n\r\n\tconstructor( json = {}, options = {} ) {\r\n\r\n\t\tthis.json = json;\r\n\t\tthis.extensions = {};\r\n\t\tthis.plugins = {};\r\n\t\tthis.options = options;\r\n\r\n\t\t// loader object cache\r\n\t\tthis.cache = new GLTFRegistry();\r\n\r\n\t\t// associations between Three.js objects and glTF elements\r\n\t\tthis.associations = new Map();\r\n\r\n\t\t// BufferGeometry caching\r\n\t\tthis.primitiveCache = {};\r\n\r\n\t\t// Object3D instance caches\r\n\t\tthis.meshCache = { refs: {}, uses: {} };\r\n\t\tthis.cameraCache = { refs: {}, uses: {} };\r\n\t\tthis.lightCache = { refs: {}, uses: {} };\r\n\r\n\t\tthis.sourceCache = {};\r\n\t\tthis.textureCache = {};\r\n\r\n\t\t// Track node names, to ensure no duplicates\r\n\t\tthis.nodeNamesUsed = {};\r\n\r\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\r\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\r\n\t\tif ( typeof createImageBitmap !== 'undefined' && /^((?!chrome|android).)*safari/i.test( navigator.userAgent ) === false ) {\r\n\r\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\r\n\r\n\t\t}\r\n\r\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\r\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\r\n\r\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\r\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\r\n\r\n\t\t\tthis.fileLoader.setWithCredentials( true );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetExtensions( extensions ) {\r\n\r\n\t\tthis.extensions = extensions;\r\n\r\n\t}\r\n\r\n\tsetPlugins( plugins ) {\r\n\r\n\t\tthis.plugins = plugins;\r\n\r\n\t}\r\n\r\n\tparse( onLoad, onError ) {\r\n\r\n\t\tconst parser = this;\r\n\t\tconst json = this.json;\r\n\t\tconst extensions = this.extensions;\r\n\r\n\t\t// Clear the loader cache\r\n\t\tthis.cache.removeAll();\r\n\r\n\t\t// Mark the special nodes/meshes in json for efficient parse\r\n\t\tthis._invokeAll( function ( ext ) {\r\n\r\n\t\t\treturn ext._markDefs && ext._markDefs();\r\n\r\n\t\t} );\r\n\r\n\t\tPromise.all( this._invokeAll( function ( ext ) {\r\n\r\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\r\n\r\n\t\t} ) ).then( function () {\r\n\r\n\t\t\treturn Promise.all( [\r\n\r\n\t\t\t\tparser.getDependencies( 'scene' ),\r\n\t\t\t\tparser.getDependencies( 'animation' ),\r\n\t\t\t\tparser.getDependencies( 'camera' ),\r\n\r\n\t\t\t] );\r\n\r\n\t\t} ).then( function ( dependencies ) {\r\n\r\n\t\t\tconst result = {\r\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\r\n\t\t\t\tscenes: dependencies[ 0 ],\r\n\t\t\t\tanimations: dependencies[ 1 ],\r\n\t\t\t\tcameras: dependencies[ 2 ],\r\n\t\t\t\tasset: json.asset,\r\n\t\t\t\tparser: parser,\r\n\t\t\t\tuserData: {}\r\n\t\t\t};\r\n\r\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\r\n\r\n\t\t\tassignExtrasToUserData( result, json );\r\n\r\n\t\t\tPromise.all( parser._invokeAll( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\r\n\r\n\t\t\t} ) ).then( function () {\r\n\r\n\t\t\t\tonLoad( result );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} ).catch( onError );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Marks the special nodes/meshes in json for efficient parse.\r\n\t */\r\n\t_markDefs() {\r\n\r\n\t\tconst nodeDefs = this.json.nodes || [];\r\n\t\tconst skinDefs = this.json.skins || [];\r\n\t\tconst meshDefs = this.json.meshes || [];\r\n\r\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\r\n\t\t// Object3D. Use the skins' joint references to mark bones.\r\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\r\n\r\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\r\n\r\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Iterate over all nodes, marking references to shared resources,\r\n\t\t// as well as skeleton joints.\r\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\r\n\r\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\r\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\r\n\t\t\t\t// to mark SkinnedMesh if node has skin.\r\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Counts references to shared node / Object3D resources. These resources\r\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\r\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\r\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\r\n\t * Textures) can be reused directly and are not marked here.\r\n\t *\r\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n\t */\r\n\t_addNodeRef( cache, index ) {\r\n\r\n\t\tif ( index === undefined ) return;\r\n\r\n\t\tif ( cache.refs[ index ] === undefined ) {\r\n\r\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\r\n\r\n\t\t}\r\n\r\n\t\tcache.refs[ index ] ++;\r\n\r\n\t}\r\n\r\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\r\n\t_getNodeRef( cache, index, object ) {\r\n\r\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\r\n\r\n\t\tconst ref = object.clone();\r\n\r\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\r\n\t\t// original object from being lost.\r\n\t\tconst updateMappings = ( original, clone ) => {\r\n\r\n\t\t\tconst mappings = this.associations.get( original );\r\n\t\t\tif ( mappings != null ) {\r\n\r\n\t\t\t\tthis.associations.set( clone, mappings );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\r\n\r\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tupdateMappings( object, ref );\r\n\r\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\r\n\r\n\t\treturn ref;\r\n\r\n\t}\r\n\r\n\t_invokeOne( func ) {\r\n\r\n\t\tconst extensions = Object.values( this.plugins );\r\n\t\textensions.push( this );\r\n\r\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\r\n\r\n\t\t\tconst result = func( extensions[ i ] );\r\n\r\n\t\t\tif ( result ) return result;\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t_invokeAll( func ) {\r\n\r\n\t\tconst extensions = Object.values( this.plugins );\r\n\t\textensions.unshift( this );\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\r\n\r\n\t\t\tconst result = func( extensions[ i ] );\r\n\r\n\t\t\tif ( result ) pending.push( result );\r\n\r\n\t\t}\r\n\r\n\t\treturn pending;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Requests the specified dependency asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @param {number} index\r\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\r\n\t */\r\n\tgetDependency( type, index ) {\r\n\r\n\t\tconst cacheKey = type + ':' + index;\r\n\t\tlet dependency = this.cache.get( cacheKey );\r\n\r\n\t\tif ( ! dependency ) {\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 'scene':\r\n\t\t\t\t\tdependency = this.loadScene( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'node':\r\n\t\t\t\t\tdependency = this.loadNode( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'mesh':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'accessor':\r\n\t\t\t\t\tdependency = this.loadAccessor( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'bufferView':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'buffer':\r\n\t\t\t\t\tdependency = this.loadBuffer( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'material':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'texture':\r\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'skin':\r\n\t\t\t\t\tdependency = this.loadSkin( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'animation':\r\n\t\t\t\t\tdependency = this.loadAnimation( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'camera':\r\n\t\t\t\t\tdependency = this.loadCamera( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.cache.add( cacheKey, dependency );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependency;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Requests all dependencies of the specified type asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @return {Promise<Array<Object>>}\r\n\t */\r\n\tgetDependencies( type ) {\r\n\r\n\t\tlet dependencies = this.cache.get( type );\r\n\r\n\t\tif ( ! dependencies ) {\r\n\r\n\t\t\tconst parser = this;\r\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\r\n\r\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\r\n\r\n\t\t\t\treturn parser.getDependency( type, index );\r\n\r\n\t\t\t} ) );\r\n\r\n\t\t\tthis.cache.add( type, dependencies );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependencies;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tloadBuffer( bufferIndex ) {\r\n\r\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\r\n\t\tconst loader = this.fileLoader;\r\n\r\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\t// If present, GLB container is required to be the first buffer.\r\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\r\n\r\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\r\n\r\n\t\t}\r\n\r\n\t\tconst options = this.options;\r\n\r\n\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\r\n\r\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferViewIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tloadBufferView( bufferViewIndex ) {\r\n\r\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\r\n\r\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\r\n\r\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\r\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n\t * @param {number} accessorIndex\r\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\r\n\t */\r\n\tloadAccessor( accessorIndex ) {\r\n\r\n\t\tconst parser = this;\r\n\t\tconst json = this.json;\r\n\r\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\r\n\r\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\r\n\r\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\r\n\t\t\t// information about attributes coming from another source (e.g. Draco\r\n\t\t\t// compression extension).\r\n\t\t\treturn Promise.resolve( null );\r\n\r\n\t\t}\r\n\r\n\t\tconst pendingBufferViews = [];\r\n\r\n\t\tif ( accessorDef.bufferView !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tpendingBufferViews.push( null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\r\n\r\n\t\t\tconst bufferView = bufferViews[ 0 ];\r\n\r\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\r\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n\t\t\tconst itemBytes = elementBytes * itemSize;\r\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\r\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\r\n\t\t\tconst normalized = accessorDef.normalized === true;\r\n\t\t\tlet array, bufferAttribute;\r\n\r\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\r\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\r\n\r\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\r\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\r\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\r\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\r\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\r\n\r\n\t\t\t\tif ( ! ib ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\r\n\r\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\r\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\r\n\r\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( bufferView === null ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n\t\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\r\n\r\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\r\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\r\n\r\n\t\t\t\tif ( bufferView !== null ) {\r\n\r\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tconst index = sparseIndices[ i ];\r\n\r\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\r\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\r\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\r\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\r\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bufferAttribute;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise<THREE.Texture>}\r\n\t */\r\n\tloadTexture( textureIndex ) {\r\n\r\n\t\tconst json = this.json;\r\n\t\tconst options = this.options;\r\n\t\tconst textureDef = json.textures[ textureIndex ];\r\n\t\tconst sourceIndex = textureDef.source;\r\n\t\tconst sourceDef = json.images[ sourceIndex ];\r\n\r\n\t\tlet loader = this.textureLoader;\r\n\r\n\t\tif ( sourceDef.uri ) {\r\n\r\n\t\t\tconst handler = options.manager.getHandler( sourceDef.uri );\r\n\t\t\tif ( handler !== null ) loader = handler;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.loadTextureImage( textureIndex, sourceIndex, loader );\r\n\r\n\t}\r\n\r\n\tloadTextureImage( textureIndex, sourceIndex, loader ) {\r\n\r\n\t\tconst parser = this;\r\n\t\tconst json = this.json;\r\n\r\n\t\tconst textureDef = json.textures[ textureIndex ];\r\n\t\tconst sourceDef = json.images[ sourceIndex ];\r\n\r\n\t\tconst cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;\r\n\r\n\t\tif ( this.textureCache[ cacheKey ] ) {\r\n\r\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\r\n\t\t\treturn this.textureCache[ cacheKey ];\r\n\r\n\t\t}\r\n\r\n\t\tconst promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {\r\n\r\n\t\t\ttexture.flipY = false;\r\n\r\n\t\t\tif ( textureDef.name ) texture.name = textureDef.name;\r\n\r\n\t\t\tconst samplers = json.samplers || {};\r\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\r\n\r\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\r\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\r\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\r\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\r\n\r\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} ).catch( function () {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t} );\r\n\r\n\t\tthis.textureCache[ cacheKey ] = promise;\r\n\r\n\t\treturn promise;\r\n\r\n\t}\r\n\r\n\tloadImageSource( sourceIndex, loader ) {\r\n\r\n\t\tconst parser = this;\r\n\t\tconst json = this.json;\r\n\t\tconst options = this.options;\r\n\r\n\t\tif ( this.sourceCache[ sourceIndex ] !== undefined ) {\r\n\r\n\t\t\treturn this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );\r\n\r\n\t\t}\r\n\r\n\t\tconst sourceDef = json.images[ sourceIndex ];\r\n\r\n\t\tconst URL = self.URL || self.webkitURL;\r\n\r\n\t\tlet sourceURI = sourceDef.uri || '';\r\n\t\tlet isObjectURL = false;\r\n\r\n\t\tif ( sourceDef.bufferView !== undefined ) {\r\n\r\n\t\t\t// Load binary image data from bufferView, if provided.\r\n\r\n\t\t\tsourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {\r\n\r\n\t\t\t\tisObjectURL = true;\r\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );\r\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\r\n\t\t\t\treturn sourceURI;\r\n\r\n\t\t\t} );\r\n\r\n\t\t} else if ( sourceDef.uri === undefined ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );\r\n\r\n\t\t}\r\n\r\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\r\n\r\n\t\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\t\tlet onLoad = resolve;\r\n\r\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\r\n\r\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\r\n\r\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\r\n\t\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t\t\tresolve( texture );\r\n\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} ).then( function ( texture ) {\r\n\r\n\t\t\t// Clean up resources and configure Texture.\r\n\r\n\t\t\tif ( isObjectURL === true ) {\r\n\r\n\t\t\t\tURL.revokeObjectURL( sourceURI );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} ).catch( function ( error ) {\r\n\r\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\r\n\t\t\tthrow error;\r\n\r\n\t\t} );\r\n\r\n\t\tthis.sourceCache[ sourceIndex ] = promise;\r\n\t\treturn promise;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Asynchronously assigns a texture to the given material parameters.\r\n\t * @param {Object} materialParams\r\n\t * @param {string} mapName\r\n\t * @param {Object} mapDef\r\n\t * @return {Promise<Texture>}\r\n\t */\r\n\tassignTexture( materialParams, mapName, mapDef, encoding ) {\r\n\r\n\t\tconst parser = this;\r\n\r\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\r\n\r\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\r\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\r\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\r\n\r\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\r\n\r\n\t\t\t\tif ( transform ) {\r\n\r\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\r\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\r\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( encoding !== undefined ) {\r\n\r\n\t\t\t\ttexture.encoding = encoding;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams[ mapName ] = texture;\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\r\n\t * already has a material (generated from the glTF material options alone)\r\n\t * but reuse of the same glTF material may require multiple threejs materials\r\n\t * to accommodate different primitive types, defines, etc. New materials will\r\n\t * be created if necessary, and reused from a cache.\r\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\r\n\t */\r\n\tassignFinalMaterial( mesh ) {\r\n\r\n\t\tconst geometry = mesh.geometry;\r\n\t\tlet material = mesh.material;\r\n\r\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\r\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\r\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\r\n\r\n\t\tif ( mesh.isPoints ) {\r\n\r\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\r\n\r\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! pointsMaterial ) {\r\n\r\n\t\t\t\tpointsMaterial = new PointsMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\r\n\t\t\t\tpointsMaterial.color.copy( material.color );\r\n\t\t\t\tpointsMaterial.map = material.map;\r\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = pointsMaterial;\r\n\r\n\t\t} else if ( mesh.isLine ) {\r\n\r\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\r\n\r\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! lineMaterial ) {\r\n\r\n\t\t\t\tlineMaterial = new LineBasicMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\r\n\t\t\t\tlineMaterial.color.copy( material.color );\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = lineMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// Clone the material if it will be modified\r\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\r\n\r\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\r\n\r\n\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) cacheKey += 'specular-glossiness:';\r\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\r\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\r\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\r\n\r\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! cachedMaterial ) {\r\n\r\n\t\t\t\tcachedMaterial = material.clone();\r\n\r\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\r\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\r\n\r\n\t\t\t\tif ( useDerivativeTangents ) {\r\n\r\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\r\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\r\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\r\n\r\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = cachedMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// workarounds for mesh and geometry\r\n\r\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\r\n\r\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\r\n\r\n\t\t}\r\n\r\n\t\tmesh.material = material;\r\n\r\n\t}\r\n\r\n\tgetMaterialType( /* materialIndex */ ) {\r\n\r\n\t\treturn MeshStandardMaterial;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n\t * @param {number} materialIndex\r\n\t * @return {Promise<Material>}\r\n\t */\r\n\tloadMaterial( materialIndex ) {\r\n\r\n\t\tconst parser = this;\r\n\t\tconst json = this.json;\r\n\t\tconst extensions = this.extensions;\r\n\t\tconst materialDef = json.materials[ materialIndex ];\r\n\r\n\t\tlet materialType;\r\n\t\tconst materialParams = {};\r\n\t\tconst materialExtensions = materialDef.extensions || {};\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\r\n\r\n\t\t\tconst sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\tmaterialType = sgExtension.getMaterialType();\r\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\r\n\r\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\r\n\t\t\tmaterialType = kmuExtension.getMaterialType();\r\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Specification:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\r\n\r\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, sRGBEncoding ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\r\n\r\n\t\t\t} ) ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.doubleSided === true ) {\r\n\r\n\t\t\tmaterialParams.side = DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\r\n\r\n\t\t\tmaterialParams.transparent = true;\r\n\r\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\r\n\t\t\tmaterialParams.depthWrite = false;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialParams.transparent = false;\r\n\r\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\r\n\r\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\r\n\r\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\r\n\r\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\r\n\r\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\r\n\r\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, sRGBEncoding ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\tlet material;\r\n\r\n\t\t\tif ( materialType === GLTFMeshStandardSGMaterial ) {\r\n\r\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = new materialType( materialParams );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\r\n\r\n\t\t\tassignExtrasToUserData( material, materialDef );\r\n\r\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\r\n\r\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/** When Object3D instances are targeted by animation, they need unique names. */\r\n\tcreateUniqueName( originalName ) {\r\n\r\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\r\n\r\n\t\tlet name = sanitizedName;\r\n\r\n\t\tfor ( let i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\r\n\r\n\t\t\tname = sanitizedName + '_' + i;\r\n\r\n\t\t}\r\n\r\n\t\tthis.nodeNamesUsed[ name ] = true;\r\n\r\n\t\treturn name;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n\t *\r\n\t * Creates BufferGeometries from primitives.\r\n\t *\r\n\t * @param {Array<GLTF.Primitive>} primitives\r\n\t * @return {Promise<Array<BufferGeometry>>}\r\n\t */\r\n\tloadGeometries( primitives ) {\r\n\r\n\t\tconst parser = this;\r\n\t\tconst extensions = this.extensions;\r\n\t\tconst cache = this.primitiveCache;\r\n\r\n\t\tfunction createDracoPrimitive( primitive ) {\r\n\r\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\r\n\t\t\t\t.decodePrimitive( primitive, parser )\r\n\t\t\t\t.then( function ( geometry ) {\r\n\r\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst primitive = primitives[ i ];\r\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\r\n\r\n\t\t\t// See if we've already created this geometry\r\n\t\t\tconst cached = cache[ cacheKey ];\r\n\r\n\t\t\tif ( cached ) {\r\n\r\n\t\t\t\t// Use the cached geometry if it exists\r\n\t\t\t\tpending.push( cached.promise );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlet geometryPromise;\r\n\r\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\r\n\r\n\t\t\t\t\t// Use DRACO geometry if available\r\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Otherwise create a new geometry\r\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cache this geometry\r\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\r\n\r\n\t\t\t\tpending.push( geometryPromise );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n\t * @param {number} meshIndex\r\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\r\n\t */\r\n\tloadMesh( meshIndex ) {\r\n\r\n\t\tconst parser = this;\r\n\t\tconst json = this.json;\r\n\t\tconst extensions = this.extensions;\r\n\r\n\t\tconst meshDef = json.meshes[ meshIndex ];\r\n\t\tconst primitives = meshDef.primitives;\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst material = primitives[ i ].material === undefined\r\n\t\t\t\t? createDefaultMaterial( this.cache )\r\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\r\n\r\n\t\t\tpending.push( material );\r\n\r\n\t\t}\r\n\r\n\t\tpending.push( parser.loadGeometries( primitives ) );\r\n\r\n\t\treturn Promise.all( pending ).then( function ( results ) {\r\n\r\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\r\n\t\t\tconst geometries = results[ results.length - 1 ];\r\n\r\n\t\t\tconst meshes = [];\r\n\r\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tconst geometry = geometries[ i ];\r\n\t\t\t\tconst primitive = primitives[ i ];\r\n\r\n\t\t\t\t// 1. create Mesh\r\n\r\n\t\t\t\tlet mesh;\r\n\r\n\t\t\t\tconst material = materials[ i ];\r\n\r\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n\t\t\t\t\t\tprimitive.mode === undefined ) {\r\n\r\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\r\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\r\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\r\n\t\t\t\t\t\t: new Mesh( geometry, material );\r\n\r\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\r\n\r\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\r\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\r\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\r\n\r\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\r\n\r\n\t\t\t\t\tmesh = new Line( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\r\n\r\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\r\n\r\n\t\t\t\t\tmesh = new Points( geometry, material );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\r\n\r\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\r\n\r\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\r\n\r\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\r\n\r\n\t\t\t\tparser.assignFinalMaterial( mesh );\r\n\r\n\t\t\t\tmeshes.push( mesh );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tparser.associations.set( meshes[ i ], {\r\n\t\t\t\t\tmeshes: meshIndex,\r\n\t\t\t\t\tprimitives: i\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( meshes.length === 1 ) {\r\n\r\n\t\t\t\treturn meshes[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst group = new Group();\r\n\r\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\r\n\r\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tgroup.add( meshes[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n\t * @param {number} cameraIndex\r\n\t * @return {Promise<THREE.Camera>}\r\n\t */\r\n\tloadCamera( cameraIndex ) {\r\n\r\n\t\tlet camera;\r\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\r\n\t\tconst params = cameraDef[ cameraDef.type ];\r\n\r\n\t\tif ( ! params ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.type === 'perspective' ) {\r\n\r\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\r\n\r\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\r\n\r\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\r\n\r\n\t\tassignExtrasToUserData( camera, cameraDef );\r\n\r\n\t\treturn Promise.resolve( camera );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n\t * @param {number} skinIndex\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tloadSkin( skinIndex ) {\r\n\r\n\t\tconst skinDef = this.json.skins[ skinIndex ];\r\n\r\n\t\tconst skinEntry = { joints: skinDef.joints };\r\n\r\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\r\n\r\n\t\t\treturn Promise.resolve( skinEntry );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\r\n\r\n\t\t\tskinEntry.inverseBindMatrices = accessor;\r\n\r\n\t\t\treturn skinEntry;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n\t * @param {number} animationIndex\r\n\t * @return {Promise<AnimationClip>}\r\n\t */\r\n\tloadAnimation( animationIndex ) {\r\n\r\n\t\tconst json = this.json;\r\n\r\n\t\tconst animationDef = json.animations[ animationIndex ];\r\n\r\n\t\tconst pendingNodes = [];\r\n\t\tconst pendingInputAccessors = [];\r\n\t\tconst pendingOutputAccessors = [];\r\n\t\tconst pendingSamplers = [];\r\n\t\tconst pendingTargets = [];\r\n\r\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst channel = animationDef.channels[ i ];\r\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\r\n\t\t\tconst target = channel.target;\r\n\t\t\tconst name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\r\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\r\n\r\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\r\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\r\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\r\n\t\t\tpendingSamplers.push( sampler );\r\n\t\t\tpendingTargets.push( target );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( [\r\n\r\n\t\t\tPromise.all( pendingNodes ),\r\n\t\t\tPromise.all( pendingInputAccessors ),\r\n\t\t\tPromise.all( pendingOutputAccessors ),\r\n\t\t\tPromise.all( pendingSamplers ),\r\n\t\t\tPromise.all( pendingTargets )\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tconst nodes = dependencies[ 0 ];\r\n\t\t\tconst inputAccessors = dependencies[ 1 ];\r\n\t\t\tconst outputAccessors = dependencies[ 2 ];\r\n\t\t\tconst samplers = dependencies[ 3 ];\r\n\t\t\tconst targets = dependencies[ 4 ];\r\n\r\n\t\t\tconst tracks = [];\r\n\r\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tconst node = nodes[ i ];\r\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\r\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\r\n\t\t\t\tconst sampler = samplers[ i ];\r\n\t\t\t\tconst target = targets[ i ];\r\n\r\n\t\t\t\tif ( node === undefined ) continue;\r\n\r\n\t\t\t\tnode.updateMatrix();\r\n\t\t\t\tnode.matrixAutoUpdate = true;\r\n\r\n\t\t\t\tlet TypedKeyframeTrack;\r\n\r\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.position:\r\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst targetName = node.name ? node.name : node.uuid;\r\n\r\n\t\t\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\r\n\r\n\t\t\t\tconst targetNames = [];\r\n\r\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\r\n\r\n\t\t\t\t\tnode.traverse( function ( object ) {\r\n\r\n\t\t\t\t\t\tif ( object.morphTargetInfluences ) {\r\n\r\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttargetNames.push( targetName );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet outputArray = outputAccessor.array;\r\n\r\n\t\t\t\tif ( outputAccessor.normalized ) {\r\n\r\n\t\t\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\r\n\t\t\t\t\tconst scaled = new Float32Array( outputArray.length );\r\n\r\n\t\t\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toutputArray = scaled;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tconst track = new TypedKeyframeTrack(\r\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\r\n\t\t\t\t\t\tinputAccessor.array,\r\n\t\t\t\t\t\toutputArray,\r\n\t\t\t\t\t\tinterpolation\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Override interpolation with custom factory method.\r\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\r\n\r\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\r\n\r\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\r\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\r\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\r\n\r\n\t\t\t\t\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\r\n\r\n\t\t\t\t\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\r\n\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\r\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttracks.push( track );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n\t\t\treturn new AnimationClip( name, undefined, tracks );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tcreateNodeMesh( nodeIndex ) {\r\n\r\n\t\tconst json = this.json;\r\n\t\tconst parser = this;\r\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\r\n\r\n\t\tif ( nodeDef.mesh === undefined ) return null;\r\n\r\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\r\n\r\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\r\n\r\n\t\t\t// if weights are provided on the node, override weights on the mesh.\r\n\t\t\tif ( nodeDef.weights !== undefined ) {\r\n\r\n\t\t\t\tnode.traverse( function ( o ) {\r\n\r\n\t\t\t\t\tif ( ! o.isMesh ) return;\r\n\r\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n\t * @param {number} nodeIndex\r\n\t * @return {Promise<Object3D>}\r\n\t */\r\n\tloadNode( nodeIndex ) {\r\n\r\n\t\tconst json = this.json;\r\n\t\tconst extensions = this.extensions;\r\n\t\tconst parser = this;\r\n\r\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\r\n\r\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\r\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\r\n\r\n\t\treturn ( function () {\r\n\r\n\t\t\tconst pending = [];\r\n\r\n\t\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( meshPromise ) {\r\n\r\n\t\t\t\tpending.push( meshPromise );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\r\n\r\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser._invokeAll( function ( ext ) {\r\n\r\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\r\n\r\n\t\t\t} ).forEach( function ( promise ) {\r\n\r\n\t\t\t\tpending.push( promise );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn Promise.all( pending );\r\n\r\n\t\t}() ).then( function ( objects ) {\r\n\r\n\t\t\tlet node;\r\n\r\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\r\n\t\t\tif ( nodeDef.isBone === true ) {\r\n\r\n\t\t\t\tnode = new Bone();\r\n\r\n\t\t\t} else if ( objects.length > 1 ) {\r\n\r\n\t\t\t\tnode = new Group();\r\n\r\n\t\t\t} else if ( objects.length === 1 ) {\r\n\r\n\t\t\t\tnode = objects[ 0 ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode = new Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( node !== objects[ 0 ] ) {\r\n\r\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tnode.add( objects[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.name ) {\r\n\r\n\t\t\t\tnode.userData.name = nodeDef.name;\r\n\t\t\t\tnode.name = nodeName;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tassignExtrasToUserData( node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.matrix !== undefined ) {\r\n\r\n\t\t\t\tconst matrix = new Matrix4();\r\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\r\n\t\t\t\tnode.applyMatrix4( matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\r\n\r\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! parser.associations.has( node ) ) {\r\n\r\n\t\t\t\tparser.associations.set( node, {} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n\t * @param {number} sceneIndex\r\n\t * @return {Promise<Group>}\r\n\t */\r\n\tloadScene( sceneIndex ) {\r\n\r\n\t\tconst json = this.json;\r\n\t\tconst extensions = this.extensions;\r\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\r\n\t\tconst parser = this;\r\n\r\n\t\t// Loader returns Group, not Scene.\r\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\r\n\t\tconst scene = new Group();\r\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\r\n\r\n\t\tassignExtrasToUserData( scene, sceneDef );\r\n\r\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\r\n\r\n\t\tconst nodeIds = sceneDef.nodes || [];\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\r\n\r\n\t\t\tpending.push( buildNodeHierarchy( nodeIds[ i ], scene, json, parser ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\t// Removes dangling associations, associations that reference a node that\r\n\t\t\t// didn't make it into the scene.\r\n\t\t\tconst reduceAssociations = ( node ) => {\r\n\r\n\t\t\t\tconst reducedAssociations = new Map();\r\n\r\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\r\n\r\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\r\n\r\n\t\t\t\t\t\treducedAssociations.set( key, value );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode.traverse( ( node ) => {\r\n\r\n\t\t\t\t\tconst mappings = parser.associations.get( node );\r\n\r\n\t\t\t\t\tif ( mappings != null ) {\r\n\r\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\treturn reducedAssociations;\r\n\r\n\t\t\t};\r\n\r\n\t\t\tparser.associations = reduceAssociations( scene );\r\n\r\n\t\t\treturn scene;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction buildNodeHierarchy( nodeId, parentObject, json, parser ) {\r\n\r\n\tconst nodeDef = json.nodes[ nodeId ];\r\n\r\n\treturn parser.getDependency( 'node', nodeId ).then( function ( node ) {\r\n\r\n\t\tif ( nodeDef.skin === undefined ) return node;\r\n\r\n\t\t// build skeleton here as well\r\n\r\n\t\tlet skinEntry;\r\n\r\n\t\treturn parser.getDependency( 'skin', nodeDef.skin ).then( function ( skin ) {\r\n\r\n\t\t\tskinEntry = skin;\r\n\r\n\t\t\tconst pendingJoints = [];\r\n\r\n\t\t\tfor ( let i = 0, il = skinEntry.joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tpendingJoints.push( parser.getDependency( 'node', skinEntry.joints[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( pendingJoints );\r\n\r\n\t\t} ).then( function ( jointNodes ) {\r\n\r\n\t\t\tnode.traverse( function ( mesh ) {\r\n\r\n\t\t\t\tif ( ! mesh.isMesh ) return;\r\n\r\n\t\t\t\tconst bones = [];\r\n\t\t\t\tconst boneInverses = [];\r\n\r\n\t\t\t\tfor ( let j = 0, jl = jointNodes.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tconst jointNode = jointNodes[ j ];\r\n\r\n\t\t\t\t\tif ( jointNode ) {\r\n\r\n\t\t\t\t\t\tbones.push( jointNode );\r\n\r\n\t\t\t\t\t\tconst mat = new Matrix4();\r\n\r\n\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tboneInverses.push( mat );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[ j ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.bind( new Skeleton( bones, boneInverses ), mesh.matrixWorld );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t} ).then( function ( node ) {\r\n\r\n\t\t// build node hierachy\r\n\r\n\t\tparentObject.add( node );\r\n\r\n\t\tconst pending = [];\r\n\r\n\t\tif ( nodeDef.children ) {\r\n\r\n\t\t\tconst children = nodeDef.children;\r\n\r\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tpending.push( buildNodeHierarchy( child, node, json, parser ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t} );\r\n\r\n}\r\n\r\n/**\r\n * @param {BufferGeometry} geometry\r\n * @param {GLTF.Primitive} primitiveDef\r\n * @param {GLTFParser} parser\r\n */\r\nfunction computeBounds( geometry, primitiveDef, parser ) {\r\n\r\n\tconst attributes = primitiveDef.attributes;\r\n\r\n\tconst box = new Box3();\r\n\r\n\tif ( attributes.POSITION !== undefined ) {\r\n\r\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\r\n\r\n\t\tconst min = accessor.min;\r\n\t\tconst max = accessor.max;\r\n\r\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\tbox.set(\r\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\r\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\r\n\t\t\t);\r\n\r\n\t\t\tif ( accessor.normalized ) {\r\n\r\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\r\n\t\t\t\tbox.min.multiplyScalar( boxScale );\r\n\t\t\t\tbox.max.multiplyScalar( boxScale );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tconst targets = primitiveDef.targets;\r\n\r\n\tif ( targets !== undefined ) {\r\n\r\n\t\tconst maxDisplacement = new Vector3();\r\n\t\tconst vector = new Vector3();\r\n\r\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst target = targets[ i ];\r\n\r\n\t\t\tif ( target.POSITION !== undefined ) {\r\n\r\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\r\n\t\t\t\tconst min = accessor.min;\r\n\t\t\t\tconst max = accessor.max;\r\n\r\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\r\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\r\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\r\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\r\n\r\n\r\n\t\t\t\t\tif ( accessor.normalized ) {\r\n\r\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\r\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\r\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\r\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\r\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\r\n\t\t\t\t\tmaxDisplacement.max( vector );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\r\n\t\tbox.expandByVector( maxDisplacement );\r\n\r\n\t}\r\n\r\n\tgeometry.boundingBox = box;\r\n\r\n\tconst sphere = new Sphere();\r\n\r\n\tbox.getCenter( sphere.center );\r\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\r\n\r\n\tgeometry.boundingSphere = sphere;\r\n\r\n}\r\n\r\n/**\r\n * @param {BufferGeometry} geometry\r\n * @param {GLTF.Primitive} primitiveDef\r\n * @param {GLTFParser} parser\r\n * @return {Promise<BufferGeometry>}\r\n */\r\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\r\n\r\n\tconst attributes = primitiveDef.attributes;\r\n\r\n\tconst pending = [];\r\n\r\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\r\n\r\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\r\n\t\t\t.then( function ( accessor ) {\r\n\r\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\r\n\r\n\t\t\t} );\r\n\r\n\t}\r\n\r\n\tfor ( const gltfAttributeName in attributes ) {\r\n\r\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\r\n\r\n\t\t// Skip attributes already provided by e.g. Draco extension.\r\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\r\n\r\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\r\n\r\n\t}\r\n\r\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\r\n\r\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\r\n\r\n\t\t\tgeometry.setIndex( accessor );\r\n\r\n\t\t} );\r\n\r\n\t\tpending.push( accessor );\r\n\r\n\t}\r\n\r\n\tassignExtrasToUserData( geometry, primitiveDef );\r\n\r\n\tcomputeBounds( geometry, primitiveDef, parser );\r\n\r\n\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\treturn primitiveDef.targets !== undefined\r\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\r\n\t\t\t: geometry;\r\n\r\n\t} );\r\n\r\n}\r\n\r\n/**\r\n * @param {BufferGeometry} geometry\r\n * @param {Number} drawMode\r\n * @return {BufferGeometry}\r\n */\r\nfunction toTrianglesDrawMode( geometry, drawMode ) {\r\n\r\n\tlet index = geometry.getIndex();\r\n\r\n\t// generate index if not present\r\n\r\n\tif ( index === null ) {\r\n\r\n\t\tconst indices = [];\r\n\r\n\t\tconst position = geometry.getAttribute( 'position' );\r\n\r\n\t\tif ( position !== undefined ) {\r\n\r\n\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\r\n\r\n\t\t\t\tindices.push( i );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.setIndex( indices );\r\n\t\t\tindex = geometry.getIndex();\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\r\n\t\t\treturn geometry;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tconst numberOfTriangles = index.count - 2;\r\n\tconst newIndices = [];\r\n\r\n\tif ( drawMode === TriangleFanDrawMode ) {\r\n\r\n\t\t// gl.TRIANGLE_FAN\r\n\r\n\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\r\n\r\n\t\t\tnewIndices.push( index.getX( 0 ) );\r\n\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\t// gl.TRIANGLE_STRIP\r\n\r\n\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\r\n\r\n\t\t\tif ( i % 2 === 0 ) {\r\n\r\n\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\r\n\r\n\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\r\n\r\n\t}\r\n\r\n\t// build final geometry\r\n\r\n\tconst newGeometry = geometry.clone();\r\n\tnewGeometry.setIndex( newIndices );\r\n\r\n\treturn newGeometry;\r\n\r\n}\r\n\r\nexport { GLTFLoader };\r\n", "/**\r\n * @webxr-input-profiles/motion-controllers 1.0.0 https://github.com/immersive-web/webxr-input-profiles\r\n */\r\n\r\nconst Constants = {\r\n  Handedness: Object.freeze({\r\n    NONE: 'none',\r\n    LEFT: 'left',\r\n    RIGHT: 'right'\r\n  }),\r\n\r\n  ComponentState: Object.freeze({\r\n    DEFAULT: 'default',\r\n    TOUCHED: 'touched',\r\n    PRESSED: 'pressed'\r\n  }),\r\n\r\n  ComponentProperty: Object.freeze({\r\n    BUTTON: 'button',\r\n    X_AXIS: 'xAxis',\r\n    Y_AXIS: 'yAxis',\r\n    STATE: 'state'\r\n  }),\r\n\r\n  ComponentType: Object.freeze({\r\n    TRIGGER: 'trigger',\r\n    SQUEEZE: 'squeeze',\r\n    TOUCHPAD: 'touchpad',\r\n    THUMBSTICK: 'thumbstick',\r\n    BUTTON: 'button'\r\n  }),\r\n\r\n  ButtonTouchThreshold: 0.05,\r\n\r\n  AxisTouchThreshold: 0.1,\r\n\r\n  VisualResponseProperty: Object.freeze({\r\n    TRANSFORM: 'transform',\r\n    VISIBILITY: 'visibility'\r\n  })\r\n};\r\n\r\n/**\r\n * @description Static helper function to fetch a JSON file and turn it into a JS object\r\n * @param {string} path - Path to JSON file to be fetched\r\n */\r\nasync function fetchJsonFile(path) {\r\n  const response = await fetch(path);\r\n  if (!response.ok) {\r\n    throw new Error(response.statusText);\r\n  } else {\r\n    return response.json();\r\n  }\r\n}\r\n\r\nasync function fetchProfilesList(basePath) {\r\n  if (!basePath) {\r\n    throw new Error('No basePath supplied');\r\n  }\r\n\r\n  const profileListFileName = 'profilesList.json';\r\n  const profilesList = await fetchJsonFile(`${basePath}/${profileListFileName}`);\r\n  return profilesList;\r\n}\r\n\r\nasync function fetchProfile(xrInputSource, basePath, defaultProfile = null, getAssetPath = true) {\r\n  if (!xrInputSource) {\r\n    throw new Error('No xrInputSource supplied');\r\n  }\r\n\r\n  if (!basePath) {\r\n    throw new Error('No basePath supplied');\r\n  }\r\n\r\n  // Get the list of profiles\r\n  const supportedProfilesList = await fetchProfilesList(basePath);\r\n\r\n  // Find the relative path to the first requested profile that is recognized\r\n  let match;\r\n  xrInputSource.profiles.some((profileId) => {\r\n    const supportedProfile = supportedProfilesList[profileId];\r\n    if (supportedProfile) {\r\n      match = {\r\n        profileId,\r\n        profilePath: `${basePath}/${supportedProfile.path}`,\r\n        deprecated: !!supportedProfile.deprecated\r\n      };\r\n    }\r\n    return !!match;\r\n  });\r\n\r\n  if (!match) {\r\n    if (!defaultProfile) {\r\n      throw new Error('No matching profile name found');\r\n    }\r\n\r\n    const supportedProfile = supportedProfilesList[defaultProfile];\r\n    if (!supportedProfile) {\r\n      throw new Error(`No matching profile name found and default profile \"${defaultProfile}\" missing.`);\r\n    }\r\n\r\n    match = {\r\n      profileId: defaultProfile,\r\n      profilePath: `${basePath}/${supportedProfile.path}`,\r\n      deprecated: !!supportedProfile.deprecated\r\n    };\r\n  }\r\n\r\n  const profile = await fetchJsonFile(match.profilePath);\r\n\r\n  let assetPath;\r\n  if (getAssetPath) {\r\n    let layout;\r\n    if (xrInputSource.handedness === 'any') {\r\n      layout = profile.layouts[Object.keys(profile.layouts)[0]];\r\n    } else {\r\n      layout = profile.layouts[xrInputSource.handedness];\r\n    }\r\n    if (!layout) {\r\n      throw new Error(\r\n        `No matching handedness, ${xrInputSource.handedness}, in profile ${match.profileId}`\r\n      );\r\n    }\r\n\r\n    if (layout.assetPath) {\r\n      assetPath = match.profilePath.replace('profile.json', layout.assetPath);\r\n    }\r\n  }\r\n\r\n  return { profile, assetPath };\r\n}\r\n\r\n/** @constant {Object} */\r\nconst defaultComponentValues = {\r\n  xAxis: 0,\r\n  yAxis: 0,\r\n  button: 0,\r\n  state: Constants.ComponentState.DEFAULT\r\n};\r\n\r\n/**\r\n * @description Converts an X, Y coordinate from the range -1 to 1 (as reported by the Gamepad\r\n * API) to the range 0 to 1 (for interpolation). Also caps the X, Y values to be bounded within\r\n * a circle. This ensures that thumbsticks are not animated outside the bounds of their physical\r\n * range of motion and touchpads do not report touch locations off their physical bounds.\r\n * @param {number} x The original x coordinate in the range -1 to 1\r\n * @param {number} y The original y coordinate in the range -1 to 1\r\n */\r\nfunction normalizeAxes(x = 0, y = 0) {\r\n  let xAxis = x;\r\n  let yAxis = y;\r\n\r\n  // Determine if the point is outside the bounds of the circle\r\n  // and, if so, place it on the edge of the circle\r\n  const hypotenuse = Math.sqrt((x * x) + (y * y));\r\n  if (hypotenuse > 1) {\r\n    const theta = Math.atan2(y, x);\r\n    xAxis = Math.cos(theta);\r\n    yAxis = Math.sin(theta);\r\n  }\r\n\r\n  // Scale and move the circle so values are in the interpolation range.  The circle's origin moves\r\n  // from (0, 0) to (0.5, 0.5). The circle's radius scales from 1 to be 0.5.\r\n  const result = {\r\n    normalizedXAxis: (xAxis * 0.5) + 0.5,\r\n    normalizedYAxis: (yAxis * 0.5) + 0.5\r\n  };\r\n  return result;\r\n}\r\n\r\n/**\r\n * Contains the description of how the 3D model should visually respond to a specific user input.\r\n * This is accomplished by initializing the object with the name of a node in the 3D model and\r\n * property that need to be modified in response to user input, the name of the nodes representing\r\n * the allowable range of motion, and the name of the input which triggers the change. In response\r\n * to the named input changing, this object computes the appropriate weighting to use for\r\n * interpolating between the range of motion nodes.\r\n */\r\nclass VisualResponse {\r\n  constructor(visualResponseDescription) {\r\n    this.componentProperty = visualResponseDescription.componentProperty;\r\n    this.states = visualResponseDescription.states;\r\n    this.valueNodeName = visualResponseDescription.valueNodeName;\r\n    this.valueNodeProperty = visualResponseDescription.valueNodeProperty;\r\n\r\n    if (this.valueNodeProperty === Constants.VisualResponseProperty.TRANSFORM) {\r\n      this.minNodeName = visualResponseDescription.minNodeName;\r\n      this.maxNodeName = visualResponseDescription.maxNodeName;\r\n    }\r\n\r\n    // Initializes the response's current value based on default data\r\n    this.value = 0;\r\n    this.updateFromComponent(defaultComponentValues);\r\n  }\r\n\r\n  /**\r\n   * Computes the visual response's interpolation weight based on component state\r\n   * @param {Object} componentValues - The component from which to update\r\n   * @param {number} xAxis - The reported X axis value of the component\r\n   * @param {number} yAxis - The reported Y axis value of the component\r\n   * @param {number} button - The reported value of the component's button\r\n   * @param {string} state - The component's active state\r\n   */\r\n  updateFromComponent({\r\n    xAxis, yAxis, button, state\r\n  }) {\r\n    const { normalizedXAxis, normalizedYAxis } = normalizeAxes(xAxis, yAxis);\r\n    switch (this.componentProperty) {\r\n      case Constants.ComponentProperty.X_AXIS:\r\n        this.value = (this.states.includes(state)) ? normalizedXAxis : 0.5;\r\n        break;\r\n      case Constants.ComponentProperty.Y_AXIS:\r\n        this.value = (this.states.includes(state)) ? normalizedYAxis : 0.5;\r\n        break;\r\n      case Constants.ComponentProperty.BUTTON:\r\n        this.value = (this.states.includes(state)) ? button : 0;\r\n        break;\r\n      case Constants.ComponentProperty.STATE:\r\n        if (this.valueNodeProperty === Constants.VisualResponseProperty.VISIBILITY) {\r\n          this.value = (this.states.includes(state));\r\n        } else {\r\n          this.value = this.states.includes(state) ? 1.0 : 0.0;\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`);\r\n    }\r\n  }\r\n}\r\n\r\nclass Component {\r\n  /**\r\n   * @param {Object} componentId - Id of the component\r\n   * @param {Object} componentDescription - Description of the component to be created\r\n   */\r\n  constructor(componentId, componentDescription) {\r\n    if (!componentId\r\n     || !componentDescription\r\n     || !componentDescription.visualResponses\r\n     || !componentDescription.gamepadIndices\r\n     || Object.keys(componentDescription.gamepadIndices).length === 0) {\r\n      throw new Error('Invalid arguments supplied');\r\n    }\r\n\r\n    this.id = componentId;\r\n    this.type = componentDescription.type;\r\n    this.rootNodeName = componentDescription.rootNodeName;\r\n    this.touchPointNodeName = componentDescription.touchPointNodeName;\r\n\r\n    // Build all the visual responses for this component\r\n    this.visualResponses = {};\r\n    Object.keys(componentDescription.visualResponses).forEach((responseName) => {\r\n      const visualResponse = new VisualResponse(componentDescription.visualResponses[responseName]);\r\n      this.visualResponses[responseName] = visualResponse;\r\n    });\r\n\r\n    // Set default values\r\n    this.gamepadIndices = Object.assign({}, componentDescription.gamepadIndices);\r\n\r\n    this.values = {\r\n      state: Constants.ComponentState.DEFAULT,\r\n      button: (this.gamepadIndices.button !== undefined) ? 0 : undefined,\r\n      xAxis: (this.gamepadIndices.xAxis !== undefined) ? 0 : undefined,\r\n      yAxis: (this.gamepadIndices.yAxis !== undefined) ? 0 : undefined\r\n    };\r\n  }\r\n\r\n  get data() {\r\n    const data = { id: this.id, ...this.values };\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @description Poll for updated data based on current gamepad state\r\n   * @param {Object} gamepad - The gamepad object from which the component data should be polled\r\n   */\r\n  updateFromGamepad(gamepad) {\r\n    // Set the state to default before processing other data sources\r\n    this.values.state = Constants.ComponentState.DEFAULT;\r\n\r\n    // Get and normalize button\r\n    if (this.gamepadIndices.button !== undefined\r\n        && gamepad.buttons.length > this.gamepadIndices.button) {\r\n      const gamepadButton = gamepad.buttons[this.gamepadIndices.button];\r\n      this.values.button = gamepadButton.value;\r\n      this.values.button = (this.values.button < 0) ? 0 : this.values.button;\r\n      this.values.button = (this.values.button > 1) ? 1 : this.values.button;\r\n\r\n      // Set the state based on the button\r\n      if (gamepadButton.pressed || this.values.button === 1) {\r\n        this.values.state = Constants.ComponentState.PRESSED;\r\n      } else if (gamepadButton.touched || this.values.button > Constants.ButtonTouchThreshold) {\r\n        this.values.state = Constants.ComponentState.TOUCHED;\r\n      }\r\n    }\r\n\r\n    // Get and normalize x axis value\r\n    if (this.gamepadIndices.xAxis !== undefined\r\n        && gamepad.axes.length > this.gamepadIndices.xAxis) {\r\n      this.values.xAxis = gamepad.axes[this.gamepadIndices.xAxis];\r\n      this.values.xAxis = (this.values.xAxis < -1) ? -1 : this.values.xAxis;\r\n      this.values.xAxis = (this.values.xAxis > 1) ? 1 : this.values.xAxis;\r\n\r\n      // If the state is still default, check if the xAxis makes it touched\r\n      if (this.values.state === Constants.ComponentState.DEFAULT\r\n        && Math.abs(this.values.xAxis) > Constants.AxisTouchThreshold) {\r\n        this.values.state = Constants.ComponentState.TOUCHED;\r\n      }\r\n    }\r\n\r\n    // Get and normalize Y axis value\r\n    if (this.gamepadIndices.yAxis !== undefined\r\n        && gamepad.axes.length > this.gamepadIndices.yAxis) {\r\n      this.values.yAxis = gamepad.axes[this.gamepadIndices.yAxis];\r\n      this.values.yAxis = (this.values.yAxis < -1) ? -1 : this.values.yAxis;\r\n      this.values.yAxis = (this.values.yAxis > 1) ? 1 : this.values.yAxis;\r\n\r\n      // If the state is still default, check if the yAxis makes it touched\r\n      if (this.values.state === Constants.ComponentState.DEFAULT\r\n        && Math.abs(this.values.yAxis) > Constants.AxisTouchThreshold) {\r\n        this.values.state = Constants.ComponentState.TOUCHED;\r\n      }\r\n    }\r\n\r\n    // Update the visual response weights based on the current component data\r\n    Object.values(this.visualResponses).forEach((visualResponse) => {\r\n      visualResponse.updateFromComponent(this.values);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n  * @description Builds a motion controller with components and visual responses based on the\r\n  * supplied profile description. Data is polled from the xrInputSource's gamepad.\r\n  * @author Nell Waliczek / https://github.com/NellWaliczek\r\n*/\r\nclass MotionController {\r\n  /**\r\n   * @param {Object} xrInputSource - The XRInputSource to build the MotionController around\r\n   * @param {Object} profile - The best matched profile description for the supplied xrInputSource\r\n   * @param {Object} assetUrl\r\n   */\r\n  constructor(xrInputSource, profile, assetUrl) {\r\n    if (!xrInputSource) {\r\n      throw new Error('No xrInputSource supplied');\r\n    }\r\n\r\n    if (!profile) {\r\n      throw new Error('No profile supplied');\r\n    }\r\n\r\n    this.xrInputSource = xrInputSource;\r\n    this.assetUrl = assetUrl;\r\n    this.id = profile.profileId;\r\n\r\n    // Build child components as described in the profile description\r\n    this.layoutDescription = profile.layouts[xrInputSource.handedness];\r\n    this.components = {};\r\n    Object.keys(this.layoutDescription.components).forEach((componentId) => {\r\n      const componentDescription = this.layoutDescription.components[componentId];\r\n      this.components[componentId] = new Component(componentId, componentDescription);\r\n    });\r\n\r\n    // Initialize components based on current gamepad state\r\n    this.updateFromGamepad();\r\n  }\r\n\r\n  get gripSpace() {\r\n    return this.xrInputSource.gripSpace;\r\n  }\r\n\r\n  get targetRaySpace() {\r\n    return this.xrInputSource.targetRaySpace;\r\n  }\r\n\r\n  /**\r\n   * @description Returns a subset of component data for simplified debugging\r\n   */\r\n  get data() {\r\n    const data = [];\r\n    Object.values(this.components).forEach((component) => {\r\n      data.push(component.data);\r\n    });\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @description Poll for updated data based on current gamepad state\r\n   */\r\n  updateFromGamepad() {\r\n    Object.values(this.components).forEach((component) => {\r\n      component.updateFromGamepad(this.xrInputSource.gamepad);\r\n    });\r\n  }\r\n}\r\n\r\nexport { Constants, MotionController, fetchProfile, fetchProfilesList };\r\n", "import {\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tObject3D,\r\n\tSphereGeometry,\r\n} from 'three';\r\n\r\nimport { GLTFLoader } from '../loaders/GLTFLoader.js';\r\n\r\nimport {\r\n\tConstants as MotionControllerConstants,\r\n\tfetchProfile,\r\n\tMotionController\r\n} from '../libs/motion-controllers.module.js';\r\n\r\nconst DEFAULT_PROFILES_PATH = 'https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles';\r\nconst DEFAULT_PROFILE = 'generic-trigger';\r\n\r\nclass XRControllerModel extends Object3D {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.motionController = null;\r\n\t\tthis.envMap = null;\r\n\r\n\t}\r\n\r\n\tsetEnvironmentMap( envMap ) {\r\n\r\n\t\tif ( this.envMap == envMap ) {\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tthis.envMap = envMap;\r\n\t\tthis.traverse( ( child ) => {\r\n\r\n\t\t\tif ( child.isMesh ) {\r\n\r\n\t\t\t\tchild.material.envMap = this.envMap;\r\n\t\t\t\tchild.material.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Polls data from the XRInputSource and updates the model's components to match\r\n\t * the real world data\r\n\t */\r\n\tupdateMatrixWorld( force ) {\r\n\r\n\t\tsuper.updateMatrixWorld( force );\r\n\r\n\t\tif ( ! this.motionController ) return;\r\n\r\n\t\t// Cause the MotionController to poll the Gamepad for data\r\n\t\tthis.motionController.updateFromGamepad();\r\n\r\n\t\t// Update the 3D model to reflect the button, thumbstick, and touchpad state\r\n\t\tObject.values( this.motionController.components ).forEach( ( component ) => {\r\n\r\n\t\t\t// Update node data based on the visual responses' current states\r\n\t\t\tObject.values( component.visualResponses ).forEach( ( visualResponse ) => {\r\n\r\n\t\t\t\tconst { valueNode, minNode, maxNode, value, valueNodeProperty } = visualResponse;\r\n\r\n\t\t\t\t// Skip if the visual response node is not found. No error is needed,\r\n\t\t\t\t// because it will have been reported at load time.\r\n\t\t\t\tif ( ! valueNode ) return;\r\n\r\n\t\t\t\t// Calculate the new properties based on the weight supplied\r\n\t\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.VISIBILITY ) {\r\n\r\n\t\t\t\t\tvalueNode.visible = value;\r\n\r\n\t\t\t\t} else if ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\r\n\r\n\t\t\t\t\tvalueNode.quaternion.slerpQuaternions(\r\n\t\t\t\t\t\tminNode.quaternion,\r\n\t\t\t\t\t\tmaxNode.quaternion,\r\n\t\t\t\t\t\tvalue\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tvalueNode.position.lerpVectors(\r\n\t\t\t\t\t\tminNode.position,\r\n\t\t\t\t\t\tmaxNode.position,\r\n\t\t\t\t\t\tvalue\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Walks the model's tree to find the nodes needed to animate the components and\r\n * saves them to the motionContoller components for use in the frame loop. When\r\n * touchpads are found, attaches a touch dot to them.\r\n */\r\nfunction findNodes( motionController, scene ) {\r\n\r\n\t// Loop through the components and find the nodes needed for each components' visual responses\r\n\tObject.values( motionController.components ).forEach( ( component ) => {\r\n\r\n\t\tconst { type, touchPointNodeName, visualResponses } = component;\r\n\r\n\t\tif ( type === MotionControllerConstants.ComponentType.TOUCHPAD ) {\r\n\r\n\t\t\tcomponent.touchPointNode = scene.getObjectByName( touchPointNodeName );\r\n\t\t\tif ( component.touchPointNode ) {\r\n\r\n\t\t\t\t// Attach a touch dot to the touchpad.\r\n\t\t\t\tconst sphereGeometry = new SphereGeometry( 0.001 );\r\n\t\t\t\tconst material = new MeshBasicMaterial( { color: 0x0000FF } );\r\n\t\t\t\tconst sphere = new Mesh( sphereGeometry, material );\r\n\t\t\t\tcomponent.touchPointNode.add( sphere );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( `Could not find touch dot, ${component.touchPointNodeName}, in touchpad component ${component.id}` );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Loop through all the visual responses to be applied to this component\r\n\t\tObject.values( visualResponses ).forEach( ( visualResponse ) => {\r\n\r\n\t\t\tconst { valueNodeName, minNodeName, maxNodeName, valueNodeProperty } = visualResponse;\r\n\r\n\t\t\t// If animating a transform, find the two nodes to be interpolated between.\r\n\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\r\n\r\n\t\t\t\tvisualResponse.minNode = scene.getObjectByName( minNodeName );\r\n\t\t\t\tvisualResponse.maxNode = scene.getObjectByName( maxNodeName );\r\n\r\n\t\t\t\t// If the extents cannot be found, skip this animation\r\n\t\t\t\tif ( ! visualResponse.minNode ) {\r\n\r\n\t\t\t\t\tconsole.warn( `Could not find ${minNodeName} in the model` );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! visualResponse.maxNode ) {\r\n\r\n\t\t\t\t\tconsole.warn( `Could not find ${maxNodeName} in the model` );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// If the target node cannot be found, skip this animation\r\n\t\t\tvisualResponse.valueNode = scene.getObjectByName( valueNodeName );\r\n\t\t\tif ( ! visualResponse.valueNode ) {\r\n\r\n\t\t\t\tconsole.warn( `Could not find ${valueNodeName} in the model` );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t} );\r\n\r\n}\r\n\r\nfunction addAssetSceneToControllerModel( controllerModel, scene ) {\r\n\r\n\t// Find the nodes needed for animation and cache them on the motionController.\r\n\tfindNodes( controllerModel.motionController, scene );\r\n\r\n\t// Apply any environment map that the mesh already has set.\r\n\tif ( controllerModel.envMap ) {\r\n\r\n\t\tscene.traverse( ( child ) => {\r\n\r\n\t\t\tif ( child.isMesh ) {\r\n\r\n\t\t\t\tchild.material.envMap = controllerModel.envMap;\r\n\t\t\t\tchild.material.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// Add the glTF scene to the controllerModel.\r\n\tcontrollerModel.add( scene );\r\n\r\n}\r\n\r\nclass XRControllerModelFactory {\r\n\r\n\tconstructor( gltfLoader = null ) {\r\n\r\n\t\tthis.gltfLoader = gltfLoader;\r\n\t\tthis.path = DEFAULT_PROFILES_PATH;\r\n\t\tthis._assetCache = {};\r\n\r\n\t\t// If a GLTFLoader wasn't supplied to the constructor create a new one.\r\n\t\tif ( ! this.gltfLoader ) {\r\n\r\n\t\t\tthis.gltfLoader = new GLTFLoader();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcreateControllerModel( controller ) {\r\n\r\n\t\tconst controllerModel = new XRControllerModel();\r\n\t\tlet scene = null;\r\n\r\n\t\tcontroller.addEventListener( 'connected', ( event ) => {\r\n\r\n\t\t\tconst xrInputSource = event.data;\r\n\r\n\t\t\tif ( xrInputSource.targetRayMode !== 'tracked-pointer' || ! xrInputSource.gamepad ) return;\r\n\r\n\t\t\tfetchProfile( xrInputSource, this.path, DEFAULT_PROFILE ).then( ( { profile, assetPath } ) => {\r\n\r\n\t\t\t\tcontrollerModel.motionController = new MotionController(\r\n\t\t\t\t\txrInputSource,\r\n\t\t\t\t\tprofile,\r\n\t\t\t\t\tassetPath\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst cachedAsset = this._assetCache[ controllerModel.motionController.assetUrl ];\r\n\t\t\t\tif ( cachedAsset ) {\r\n\r\n\t\t\t\t\tscene = cachedAsset.scene.clone();\r\n\r\n\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( ! this.gltfLoader ) {\r\n\r\n\t\t\t\t\t\tthrow new Error( 'GLTFLoader not set.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.gltfLoader.setPath( '' );\r\n\t\t\t\t\tthis.gltfLoader.load( controllerModel.motionController.assetUrl, ( asset ) => {\r\n\r\n\t\t\t\t\t\tthis._assetCache[ controllerModel.motionController.assetUrl ] = asset;\r\n\r\n\t\t\t\t\t\tscene = asset.scene.clone();\r\n\r\n\t\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnull,\r\n\t\t\t\t\t() => {\r\n\r\n\t\t\t\t\t\tthrow new Error( `Asset ${controllerModel.motionController.assetUrl} missing or malformed.` );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} ).catch( ( err ) => {\r\n\r\n\t\t\t\tconsole.warn( err );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t\tcontroller.addEventListener( 'disconnected', () => {\r\n\r\n\t\t\tcontrollerModel.motionController = null;\r\n\t\t\tcontrollerModel.remove( scene );\r\n\t\t\tscene = null;\r\n\r\n\t\t} );\r\n\r\n\t\treturn controllerModel;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { XRControllerModelFactory };\r\n", "import _extends from '@babel/runtime/helpers/esm/extends';\r\nimport { XRControllerModelFactory } from 'three/examples/jsm/webxr/XRControllerModelFactory';\r\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\r\nimport React__default, { useMemo, useContext, useRef, useEffect, forwardRef, createContext, useState, createElement, useCallback } from 'react';\r\nimport { useFrame, useThree, Canvas } from '@react-three/fiber';\r\nimport { ARButton } from 'three/examples/jsm/webxr/ARButton';\r\nimport { VRButton } from 'three/examples/jsm/webxr/VRButton';\r\nimport { Raycaster, Matrix4, Group, Mesh, MeshBasicMaterial, Color, BoxBufferGeometry } from 'three';\r\nimport mergeRefs from 'react-merge-refs';\r\nimport { XRHandModelFactory } from 'three/examples/jsm/webxr/XRHandModelFactory';\r\n\r\nconst XRController = {\r\n  make: (id, gl, onConnected, onDisconnected) => {\r\n    const controller = gl.xr.getController(id);\r\n    const grip = gl.xr.getControllerGrip(id);\r\n    const xrController = {\r\n      inputSource: undefined,\r\n      grip,\r\n      controller\r\n    };\r\n    grip.userData.name = 'grip';\r\n    controller.userData.name = 'controller';\r\n    controller.addEventListener('connected', event => {\r\n      if (event.fake) {\r\n        return;\r\n      }\r\n\r\n      xrController.inputSource = event.data;\r\n      onConnected(xrController);\r\n    });\r\n    controller.addEventListener('disconnected', _ => {\r\n      onDisconnected(xrController);\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Store data associated with some objects in the scene\r\n *\r\n * For example storing event handlers:\r\n *\r\n * objectA:\r\n *   onClick: [handler, handler]\r\n * objectB:\r\n *   onHover: [handler]\r\n *   onBlur:  [handler]\r\n *\r\n */\r\nconst ObjectsState = {\r\n  make: function make() {\r\n    return new Map();\r\n  },\r\n  add: function add(state, object, key, value) {\r\n    if (!state.has(object)) {\r\n      state.set(object, {\r\n        key: [value]\r\n      });\r\n    }\r\n\r\n    const entry = state.get(object);\r\n\r\n    if (!entry[key]) {\r\n      entry[key] = [];\r\n    }\r\n\r\n    entry[key].push(value);\r\n  },\r\n  delete: function _delete(state, object, key, value) {\r\n    const entry = state.get(object);\r\n    if (!entry || !entry[key]) return;\r\n    entry[key] = entry[key].filter(it => it !== value);\r\n\r\n    if (entry[key].length === 0) {\r\n      delete entry[key];\r\n    } // Remove entry if nothing left\r\n\r\n\r\n    if (Object.keys(entry).length === 0) {\r\n      state.delete(object);\r\n    }\r\n  },\r\n  has: function has(state, object, key) {\r\n    const entry = state.get(object);\r\n    return !!(entry && entry[key]);\r\n  },\r\n  get: function get(state, object, key) {\r\n    const entry = state.get(object);\r\n    return entry && entry[key];\r\n  }\r\n};\r\n\r\nconst useXREvent = (event, handler, {\r\n  handedness\r\n} = {}) => {\r\n  const handlerRef = React__default.useRef(handler);\r\n  React__default.useEffect(() => {\r\n    handlerRef.current = handler;\r\n  }, [handler]);\r\n  const {\r\n    controllers: allControllers\r\n  } = useXR();\r\n  React__default.useEffect(() => {\r\n    const controllers = handedness ? allControllers.filter(it => it.inputSource.handedness === handedness) : allControllers;\r\n    const cleanups = [];\r\n    controllers.forEach(it => {\r\n      const listener = e => handlerRef.current({\r\n        originalEvent: e,\r\n        controller: it\r\n      });\r\n\r\n      it.controller.addEventListener(event, listener);\r\n      cleanups.push(() => it.controller.removeEventListener(event, listener));\r\n    });\r\n    return () => cleanups.forEach(fn => fn());\r\n  }, [event, allControllers, handedness]);\r\n};\r\n\r\nconst InteractionsContext = React__default.createContext({});\r\nfunction InteractionManager({\r\n  children\r\n}) {\r\n  const {\r\n    controllers\r\n  } = useXR();\r\n  const [hoverState] = React__default.useState(() => ({\r\n    left: new Map(),\r\n    right: new Map(),\r\n    none: new Map()\r\n  }));\r\n  const [interactions] = React__default.useState(() => ObjectsState.make());\r\n  const addInteraction = React__default.useCallback((object, eventType, handler) => {\r\n    ObjectsState.add(interactions, object, eventType, handler);\r\n  }, [interactions]);\r\n  const removeInteraction = React__default.useCallback((object, eventType, handler) => {\r\n    ObjectsState.delete(interactions, object, eventType, handler);\r\n  }, [interactions]);\r\n  const [raycaster] = React__default.useState(() => new Raycaster());\r\n  const intersect = React__default.useCallback(controller => {\r\n    const objects = Array.from(interactions.keys());\r\n    const tempMatrix = new Matrix4();\r\n    tempMatrix.identity().extractRotation(controller.matrixWorld);\r\n    raycaster.ray.origin.setFromMatrixPosition(controller.matrixWorld);\r\n    raycaster.ray.direction.set(0, 0, -1).applyMatrix4(tempMatrix);\r\n    return raycaster.intersectObjects(objects, true);\r\n  }, [interactions, raycaster]); // Trigger hover and blur events\r\n\r\n  useFrame(() => {\r\n    if (interactions.size === 0) {\r\n      return;\r\n    }\r\n\r\n    controllers.forEach(it => {\r\n      const {\r\n        controller\r\n      } = it;\r\n      const handedness = it.inputSource.handedness;\r\n      const hovering = hoverState[handedness];\r\n      const hits = new Set();\r\n      const intersections = intersect(controller);\r\n      intersections.forEach(intersection => {\r\n        let eventObject = intersection.object;\r\n\r\n        while (eventObject) {\r\n          if (ObjectsState.has(interactions, eventObject, 'onHover') && !hovering.has(eventObject)) {\r\n            var _ObjectsState$get;\r\n\r\n            (_ObjectsState$get = ObjectsState.get(interactions, eventObject, 'onHover')) == null ? void 0 : _ObjectsState$get.forEach(handler => handler({\r\n              controller: it,\r\n              intersection\r\n            }));\r\n          }\r\n\r\n          hovering.set(eventObject, intersection);\r\n          hits.add(eventObject.id);\r\n          eventObject = eventObject.parent;\r\n        }\r\n      }); // Trigger blur on all the object that were hovered in the previous frame\r\n      // but missed in this one\r\n\r\n      for (const eventObject of hovering.keys()) {\r\n        if (!hits.has(eventObject.id)) {\r\n          var _ObjectsState$get2;\r\n\r\n          (_ObjectsState$get2 = ObjectsState.get(interactions, eventObject, 'onBlur')) == null ? void 0 : _ObjectsState$get2.forEach(handler => handler({\r\n            controller: it\r\n          }));\r\n          hovering.delete(eventObject);\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  const triggerEvent = interaction => e => {\r\n    const hovering = hoverState[e.controller.inputSource.handedness];\r\n\r\n    for (const hovered of hovering.keys()) {\r\n      var _ObjectsState$get3;\r\n\r\n      (_ObjectsState$get3 = ObjectsState.get(interactions, hovered, interaction)) == null ? void 0 : _ObjectsState$get3.forEach(handler => handler({\r\n        controller: e.controller\r\n      }));\r\n    }\r\n  };\r\n\r\n  useXREvent('select', triggerEvent('onSelect'));\r\n  useXREvent('selectstart', triggerEvent('onSelectStart'));\r\n  useXREvent('selectend', triggerEvent('onSelectEnd'));\r\n  useXREvent('squeeze', triggerEvent('onSqueeze'));\r\n  useXREvent('squeezeend', triggerEvent('onSqueezeEnd'));\r\n  useXREvent('squeezestart', triggerEvent('onSqueezeStart'));\r\n  const contextValue = useMemo(() => ({\r\n    addInteraction,\r\n    removeInteraction,\r\n    hoverState\r\n  }), [addInteraction, removeInteraction, hoverState]);\r\n  return /*#__PURE__*/React__default.createElement(InteractionsContext.Provider, {\r\n    value: contextValue\r\n  }, children);\r\n}\r\nconst useInteraction = (ref, type, handler) => {\r\n  const {\r\n    addInteraction,\r\n    removeInteraction\r\n  } = useContext(InteractionsContext);\r\n  const isPresent = handler !== undefined;\r\n  const handlerRef = useRef(handler);\r\n  useEffect(() => {\r\n    handlerRef.current = handler;\r\n  }, [handler]);\r\n  useEffect(() => {\r\n    if (!isPresent) return;\r\n\r\n    const handlerFn = e => {\r\n      // @ts-ignore\r\n      handlerRef.current(e);\r\n    };\r\n\r\n    addInteraction(ref.current, type, handlerFn);\r\n    const maybeRef = ref.current;\r\n    return () => removeInteraction(maybeRef, type, handlerFn);\r\n  }, [type, addInteraction, removeInteraction, isPresent, ref]);\r\n};\r\nconst Interactive = forwardRef((props, passedRef) => {\r\n  const ref = useRef();\r\n  useInteraction(ref, 'onHover', props.onHover);\r\n  useInteraction(ref, 'onBlur', props.onBlur);\r\n  useInteraction(ref, 'onSelectStart', props.onSelectStart);\r\n  useInteraction(ref, 'onSelectEnd', props.onSelectEnd);\r\n  useInteraction(ref, 'onSelect', props.onSelect);\r\n  useInteraction(ref, 'onSqueezeStart', props.onSqueezeStart);\r\n  useInteraction(ref, 'onSqueezeEnd', props.onSqueezeEnd);\r\n  useInteraction(ref, 'onSqueeze', props.onSqueeze);\r\n  return /*#__PURE__*/React__default.createElement(\"group\", {\r\n    ref: mergeRefs([passedRef, ref])\r\n  }, props.children);\r\n});\r\nfunction RayGrab({\r\n  children\r\n}) {\r\n  const grabbingController = useRef();\r\n  const groupRef = useRef();\r\n  const previousTransform = useRef(undefined);\r\n  useXREvent('selectend', e => {\r\n    if (e.controller.controller === grabbingController.current) {\r\n      grabbingController.current = undefined;\r\n      previousTransform.current = undefined;\r\n    }\r\n  });\r\n  useFrame(() => {\r\n    if (!grabbingController.current || !previousTransform.current || !groupRef.current) {\r\n      return;\r\n    }\r\n\r\n    const controller = grabbingController.current;\r\n    const group = groupRef.current;\r\n    group.applyMatrix4(previousTransform.current);\r\n    group.applyMatrix4(controller.matrixWorld);\r\n    group.updateWorldMatrix(false, true);\r\n    previousTransform.current = controller.matrixWorld.clone().invert();\r\n  });\r\n  return /*#__PURE__*/React__default.createElement(Interactive, {\r\n    ref: groupRef,\r\n    onSelectStart: e => {\r\n      grabbingController.current = e.controller.controller;\r\n      previousTransform.current = e.controller.controller.matrixWorld.clone().invert();\r\n    }\r\n  }, children);\r\n}\r\n\r\nconst XRContext = createContext({});\r\n\r\nconst useControllers = group => {\r\n  const {\r\n    gl\r\n  } = useThree();\r\n  const [controllers, setControllers] = useState([]);\r\n  useEffect(() => {\r\n    const ids = [0, 1];\r\n    ids.forEach(id => {\r\n      XRController.make(id, gl, controller => {\r\n        group.add(controller.controller);\r\n        group.add(controller.grip);\r\n        setControllers(it => [...it, controller]);\r\n      }, controller => {\r\n        group.remove(controller.controller);\r\n        group.remove(controller.grip);\r\n        setControllers(existing => existing.filter(it => it !== controller));\r\n      });\r\n    });\r\n  }, [gl, group]);\r\n  return controllers;\r\n};\r\n\r\nfunction useHitTest(hitTestCallback) {\r\n  const {\r\n    gl\r\n  } = useThree();\r\n  const hitTestSource = useRef();\r\n  const hitTestSourceRequested = useRef(false);\r\n  const [hitMatrix] = useState(() => new Matrix4());\r\n  useFrame(() => {\r\n    if (!gl.xr.isPresenting) return;\r\n    const session = gl.xr.getSession();\r\n    if (!session) return;\r\n\r\n    if (!hitTestSourceRequested.current) {\r\n      session.requestReferenceSpace('viewer').then(referenceSpace => {\r\n        session.requestHitTestSource({\r\n          space: referenceSpace\r\n        }).then(source => {\r\n          hitTestSource.current = source;\r\n        });\r\n      });\r\n      session.addEventListener('end', () => {\r\n        hitTestSourceRequested.current = false;\r\n        hitTestSource.current = undefined;\r\n      }, {\r\n        once: true\r\n      });\r\n      hitTestSourceRequested.current = true;\r\n    }\r\n\r\n    if (hitTestSource.current && gl.xr.isPresenting) {\r\n      const referenceSpace = gl.xr.getReferenceSpace();\r\n\r\n      if (referenceSpace) {\r\n        // This raf is unnecesary, we should get XRFrame from r3f but it's not implemented yet\r\n        session.requestAnimationFrame((time, frame) => {\r\n          const hitTestResults = frame.getHitTestResults(hitTestSource.current);\r\n\r\n          if (hitTestResults.length) {\r\n            const hit = hitTestResults[0];\r\n            const pose = hit.getPose(referenceSpace);\r\n\r\n            if (pose) {\r\n              hitMatrix.fromArray(pose.transform.matrix);\r\n              hitTestCallback(hitMatrix, hit);\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n  });\r\n}\r\nfunction XR(props) {\r\n  const {\r\n    gl,\r\n    camera\r\n  } = useThree();\r\n  const [isPresenting, setIsPresenting] = useState(() => gl.xr.isPresenting);\r\n  const [player] = useState(() => new Group());\r\n  const controllers = useControllers(player);\r\n  useEffect(() => {\r\n    const xr = gl.xr;\r\n\r\n    const handleSessionChange = () => setIsPresenting(xr.isPresenting);\r\n\r\n    xr.addEventListener('sessionstart', handleSessionChange);\r\n    xr.addEventListener('sessionend', handleSessionChange);\r\n    return () => {\r\n      xr.removeEventListener('sessionstart', handleSessionChange);\r\n      xr.removeEventListener('sessionend', handleSessionChange);\r\n    };\r\n  }, [gl]);\r\n  const value = useMemo(() => ({\r\n    controllers,\r\n    isPresenting,\r\n    player\r\n  }), [controllers, isPresenting, player]);\r\n  return /*#__PURE__*/createElement(XRContext.Provider, {\r\n    value: value\r\n  }, /*#__PURE__*/createElement(\"primitive\", {\r\n    object: player,\r\n    dispose: null\r\n  }, /*#__PURE__*/createElement(\"primitive\", {\r\n    object: camera,\r\n    dispose: null\r\n  })), props.children);\r\n}\r\n\r\nfunction XRCanvas(_ref) {\r\n  let {\r\n    children\r\n  } = _ref,\r\n      rest = _objectWithoutPropertiesLoose(_ref, [\"children\"]);\r\n\r\n  return /*#__PURE__*/createElement(Canvas, _extends({\r\n    vr: true\r\n  }, rest), /*#__PURE__*/createElement(XR, null, /*#__PURE__*/createElement(InteractionManager, null, children)));\r\n}\r\n\r\nfunction VRCanvas(_ref2) {\r\n  let {\r\n    children\r\n  } = _ref2,\r\n      rest = _objectWithoutPropertiesLoose(_ref2, [\"children\"]);\r\n\r\n  return /*#__PURE__*/createElement(XRCanvas, _extends({\r\n    onCreated: ({\r\n      gl\r\n    }) => void document.body.appendChild(VRButton.createButton(gl))\r\n  }, rest), children);\r\n}\r\nfunction ARCanvas(_ref3) {\r\n  let {\r\n    children,\r\n    sessionInit\r\n  } = _ref3,\r\n      rest = _objectWithoutPropertiesLoose(_ref3, [\"children\", \"sessionInit\"]);\r\n\r\n  return /*#__PURE__*/createElement(XRCanvas, _extends({\r\n    onCreated: ({\r\n      gl\r\n    }) => void document.body.appendChild(ARButton.createButton(gl, sessionInit))\r\n  }, rest), children);\r\n}\r\nconst useXR = () => {\r\n  const xrValue = useContext(XRContext);\r\n  const interactionsValue = useContext(InteractionsContext);\r\n  const contextValue = useMemo(() => _extends(_extends({}, xrValue), interactionsValue), [xrValue, interactionsValue]);\r\n  return contextValue;\r\n};\r\nconst useXRFrame = callback => {\r\n  const {\r\n    gl\r\n  } = useThree();\r\n  const requestRef = useRef();\r\n  const previousTimeRef = useRef();\r\n  const loop = useCallback((time, xrFrame) => {\r\n    if (previousTimeRef.current !== undefined) {\r\n      callback(time, xrFrame);\r\n    }\r\n\r\n    previousTimeRef.current = time;\r\n    requestRef.current = gl.xr.getSession().requestAnimationFrame(loop);\r\n  }, [gl.xr, callback]);\r\n  useEffect(() => {\r\n    var _gl$xr;\r\n\r\n    if (!((_gl$xr = gl.xr) == null ? void 0 : _gl$xr.isPresenting)) {\r\n      return;\r\n    }\r\n\r\n    requestRef.current = gl.xr.getSession().requestAnimationFrame(loop);\r\n    return () => {\r\n      if (requestRef.current) {\r\n        gl.xr.getSession().cancelAnimationFrame(requestRef.current);\r\n      }\r\n    };\r\n  }, [gl.xr.isPresenting, loop]);\r\n};\r\nconst useController = handedness => {\r\n  const {\r\n    controllers\r\n  } = useXR();\r\n  const controller = useMemo(() => controllers.find(it => it.inputSource.handedness === handedness), [handedness, controllers]);\r\n  return controller;\r\n};\r\n\r\nconst modelFactory = new XRControllerModelFactory();\r\nconst modelCache = new WeakMap();\r\nfunction DefaultXRControllers({\r\n  rayMaterial = {}\r\n}) {\r\n  const {\r\n    scene\r\n  } = useThree();\r\n  const {\r\n    controllers,\r\n    hoverState\r\n  } = useXR();\r\n  const [rays] = React__default.useState(new Map()); // Show ray line when hovering objects\r\n\r\n  useFrame(() => {\r\n    controllers.forEach(it => {\r\n      const ray = rays.get(it.controller.id);\r\n      if (!ray) return;\r\n      const intersection = hoverState[it.inputSource.handedness].values().next().value;\r\n\r\n      if (!intersection || it.inputSource.handedness === 'none') {\r\n        ray.visible = false;\r\n        return;\r\n      }\r\n\r\n      const rayLength = intersection.distance; // Tiny offset to clip ray on AR devices\r\n      // that don't have handedness set to 'none'\r\n\r\n      const offset = -0.01;\r\n      ray.visible = true;\r\n      ray.scale.y = rayLength + offset;\r\n      ray.position.z = -rayLength / 2 - offset;\r\n    });\r\n  });\r\n  useEffect(() => {\r\n    const cleanups = [];\r\n    controllers.forEach(({\r\n      controller,\r\n      grip,\r\n      inputSource\r\n    }) => {\r\n      // Attach 3D model of the controller\r\n      let model;\r\n\r\n      if (modelCache.has(controller)) {\r\n        model = modelCache.get(controller);\r\n      } else {\r\n        model = modelFactory.createControllerModel(controller);\r\n        controller.dispatchEvent({\r\n          type: 'connected',\r\n          data: inputSource,\r\n          fake: true\r\n        });\r\n        modelCache.set(controller, model);\r\n      }\r\n\r\n      grip.add(model); // Add Ray line (used for hovering)\r\n\r\n      const ray = new Mesh();\r\n      ray.rotation.set(Math.PI / 2, 0, 0);\r\n      ray.material = new MeshBasicMaterial(_extends({\r\n        color: new Color(0xffffff),\r\n        opacity: 0.8,\r\n        transparent: true\r\n      }, rayMaterial));\r\n      ray.geometry = new BoxBufferGeometry(0.002, 1, 0.002);\r\n      rays.set(controller.id, ray);\r\n      controller.add(ray);\r\n      cleanups.push(() => {\r\n        grip.remove(model);\r\n        controller.remove(ray);\r\n        rays.delete(controller.id);\r\n      });\r\n    });\r\n    return () => {\r\n      cleanups.forEach(fn => fn());\r\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [controllers, scene, rays, JSON.stringify(rayMaterial)]);\r\n  return null;\r\n}\r\n\r\nfunction Hands({\r\n  profile = 'oculus'\r\n}) {\r\n  const {\r\n    scene,\r\n    gl\r\n  } = useThree();\r\n  useEffect(() => {\r\n    const handFactory = new XRHandModelFactory().setPath('https://threejs.org/examples/models/fbx/');\r\n    const options = profile === 'oculus_lowpoly' ? {\r\n      model: 'lowpoly'\r\n    } : undefined;\r\n    const threeProfile = profile === 'oculus_lowpoly' ? 'oculus' : profile; // @ts-ignore\r\n\r\n    const hand1 = gl.xr.getHand(0);\r\n    scene.add(hand1);\r\n    hand1.add(handFactory.createHandModel(hand1, threeProfile, options)); // @ts-ignore\r\n\r\n    const hand2 = gl.xr.getHand(1);\r\n    scene.add(hand2);\r\n    hand2.add(handFactory.createHandModel(hand2, threeProfile, options));\r\n  }, [scene, gl]);\r\n  return null;\r\n}\r\n\r\nexport { ARCanvas, DefaultXRControllers, Hands, InteractionManager, InteractionsContext, Interactive, RayGrab, VRCanvas, XR, XRController, useController, useHitTest, useInteraction, useXR, useXREvent, useXRFrame };\r\n", "class ARButton {\r\n\r\n\tstatic createButton( renderer, sessionInit = {} ) {\r\n\r\n\t\tconst button = document.createElement( 'button' );\r\n\r\n\t\tfunction showStartAR( /*device*/ ) {\r\n\r\n\t\t\tif ( sessionInit.domOverlay === undefined ) {\r\n\r\n\t\t\t\tconst overlay = document.createElement( 'div' );\r\n\t\t\t\toverlay.style.display = 'none';\r\n\t\t\t\tdocument.body.appendChild( overlay );\r\n\r\n\t\t\t\tconst svg = document.createElementNS( 'http://www.w3.org/2000/svg', 'svg' );\r\n\t\t\t\tsvg.setAttribute( 'width', 38 );\r\n\t\t\t\tsvg.setAttribute( 'height', 38 );\r\n\t\t\t\tsvg.style.position = 'absolute';\r\n\t\t\t\tsvg.style.right = '20px';\r\n\t\t\t\tsvg.style.top = '20px';\r\n\t\t\t\tsvg.addEventListener( 'click', function () {\r\n\r\n\t\t\t\t\tcurrentSession.end();\r\n\r\n\t\t\t\t} );\r\n\t\t\t\toverlay.appendChild( svg );\r\n\r\n\t\t\t\tconst path = document.createElementNS( 'http://www.w3.org/2000/svg', 'path' );\r\n\t\t\t\tpath.setAttribute( 'd', 'M 12,12 L 28,28 M 28,12 12,28' );\r\n\t\t\t\tpath.setAttribute( 'stroke', '#fff' );\r\n\t\t\t\tpath.setAttribute( 'stroke-width', 2 );\r\n\t\t\t\tsvg.appendChild( path );\r\n\r\n\t\t\t\tif ( sessionInit.optionalFeatures === undefined ) {\r\n\r\n\t\t\t\t\tsessionInit.optionalFeatures = [];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsessionInit.optionalFeatures.push( 'dom-overlay' );\r\n\t\t\t\tsessionInit.domOverlay = { root: overlay };\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tlet currentSession = null;\r\n\r\n\t\t\tasync function onSessionStarted( session ) {\r\n\r\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\trenderer.xr.setReferenceSpaceType( 'local' );\r\n\r\n\t\t\t\tawait renderer.xr.setSession( session );\r\n\r\n\t\t\t\tbutton.textContent = 'STOP AR';\r\n\t\t\t\tsessionInit.domOverlay.root.style.display = '';\r\n\r\n\t\t\t\tcurrentSession = session;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onSessionEnded( /*event*/ ) {\r\n\r\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tbutton.textContent = 'START AR';\r\n\t\t\t\tsessionInit.domOverlay.root.style.display = 'none';\r\n\r\n\t\t\t\tcurrentSession = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'pointer';\r\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\r\n\t\t\tbutton.style.width = '100px';\r\n\r\n\t\t\tbutton.textContent = 'START AR';\r\n\r\n\t\t\tbutton.onmouseenter = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '1.0';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onmouseleave = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '0.5';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onclick = function () {\r\n\r\n\t\t\t\tif ( currentSession === null ) {\r\n\r\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-ar', sessionInit ).then( onSessionStarted );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcurrentSession.end();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction disableButton() {\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'auto';\r\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\r\n\t\t\tbutton.style.width = '150px';\r\n\r\n\t\t\tbutton.onmouseenter = null;\r\n\t\t\tbutton.onmouseleave = null;\r\n\r\n\t\t\tbutton.onclick = null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction showARNotSupported() {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tbutton.textContent = 'AR NOT SUPPORTED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction showARNotAllowed( exception ) {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tconsole.warn( 'Exception when trying to call xr.isSessionSupported', exception );\r\n\r\n\t\t\tbutton.textContent = 'AR NOT ALLOWED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction stylizeElement( element ) {\r\n\r\n\t\t\telement.style.position = 'absolute';\r\n\t\t\telement.style.bottom = '20px';\r\n\t\t\telement.style.padding = '12px 6px';\r\n\t\t\telement.style.border = '1px solid #fff';\r\n\t\t\telement.style.borderRadius = '4px';\r\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\r\n\t\t\telement.style.color = '#fff';\r\n\t\t\telement.style.font = 'normal 13px sans-serif';\r\n\t\t\telement.style.textAlign = 'center';\r\n\t\t\telement.style.opacity = '0.5';\r\n\t\t\telement.style.outline = 'none';\r\n\t\t\telement.style.zIndex = '999';\r\n\r\n\t\t}\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\tbutton.id = 'ARButton';\r\n\t\t\tbutton.style.display = 'none';\r\n\r\n\t\t\tstylizeElement( button );\r\n\r\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-ar' ).then( function ( supported ) {\r\n\r\n\t\t\t\tsupported ? showStartAR() : showARNotSupported();\r\n\r\n\t\t\t} ).catch( showARNotAllowed );\r\n\r\n\t\t\treturn button;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst message = document.createElement( 'a' );\r\n\r\n\t\t\tif ( window.isSecureContext === false ) {\r\n\r\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\r\n\t\t\tmessage.style.width = '180px';\r\n\t\t\tmessage.style.textDecoration = 'none';\r\n\r\n\t\t\tstylizeElement( message );\r\n\r\n\t\t\treturn message;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { ARButton };\r\n", "class VRButton {\r\n\r\n\tstatic createButton( renderer, options ) {\r\n\r\n\t\tif ( options ) {\r\n\r\n\t\t\tconsole.error( 'THREE.VRButton: The \"options\" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.' );\r\n\r\n\t\t}\r\n\r\n\t\tconst button = document.createElement( 'button' );\r\n\r\n\t\tfunction showEnterVR( /*device*/ ) {\r\n\r\n\t\t\tlet currentSession = null;\r\n\r\n\t\t\tasync function onSessionStarted( session ) {\r\n\r\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tawait renderer.xr.setSession( session );\r\n\t\t\t\tbutton.textContent = 'EXIT VR';\r\n\r\n\t\t\t\tcurrentSession = session;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onSessionEnded( /*event*/ ) {\r\n\r\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\t\tcurrentSession = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'pointer';\r\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\r\n\t\t\tbutton.style.width = '100px';\r\n\r\n\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\tbutton.onmouseenter = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '1.0';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onmouseleave = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '0.5';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onclick = function () {\r\n\r\n\t\t\t\tif ( currentSession === null ) {\r\n\r\n\t\t\t\t\t// WebXR's requestReferenceSpace only works if the corresponding feature\r\n\t\t\t\t\t// was requested at session creation time. For simplicity, just ask for\r\n\t\t\t\t\t// the interesting ones as optional features, but be aware that the\r\n\t\t\t\t\t// requestReferenceSpace call will fail if it turns out to be unavailable.\r\n\t\t\t\t\t// ('local' is always available for immersive sessions and doesn't need to\r\n\t\t\t\t\t// be requested separately.)\r\n\r\n\t\t\t\t\tconst sessionInit = { optionalFeatures: [ 'local-floor', 'bounded-floor', 'hand-tracking', 'layers' ] };\r\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-vr', sessionInit ).then( onSessionStarted );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcurrentSession.end();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction disableButton() {\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'auto';\r\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\r\n\t\t\tbutton.style.width = '150px';\r\n\r\n\t\t\tbutton.onmouseenter = null;\r\n\t\t\tbutton.onmouseleave = null;\r\n\r\n\t\t\tbutton.onclick = null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction showWebXRNotFound() {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tbutton.textContent = 'VR NOT SUPPORTED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction showVRNotAllowed( exception ) {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tconsole.warn( 'Exception when trying to call xr.isSessionSupported', exception );\r\n\r\n\t\t\tbutton.textContent = 'VR NOT ALLOWED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction stylizeElement( element ) {\r\n\r\n\t\t\telement.style.position = 'absolute';\r\n\t\t\telement.style.bottom = '20px';\r\n\t\t\telement.style.padding = '12px 6px';\r\n\t\t\telement.style.border = '1px solid #fff';\r\n\t\t\telement.style.borderRadius = '4px';\r\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\r\n\t\t\telement.style.color = '#fff';\r\n\t\t\telement.style.font = 'normal 13px sans-serif';\r\n\t\t\telement.style.textAlign = 'center';\r\n\t\t\telement.style.opacity = '0.5';\r\n\t\t\telement.style.outline = 'none';\r\n\t\t\telement.style.zIndex = '999';\r\n\r\n\t\t}\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\tbutton.id = 'VRButton';\r\n\t\t\tbutton.style.display = 'none';\r\n\r\n\t\t\tstylizeElement( button );\r\n\r\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-vr' ).then( function ( supported ) {\r\n\r\n\t\t\t\tsupported ? showEnterVR() : showWebXRNotFound();\r\n\r\n\t\t\t\tif ( supported && VRButton.xrSessionIsGranted ) {\r\n\r\n\t\t\t\t\tbutton.click();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} ).catch( showVRNotAllowed );\r\n\r\n\t\t\treturn button;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst message = document.createElement( 'a' );\r\n\r\n\t\t\tif ( window.isSecureContext === false ) {\r\n\r\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\r\n\t\t\tmessage.style.width = '180px';\r\n\t\t\tmessage.style.textDecoration = 'none';\r\n\r\n\t\t\tstylizeElement( message );\r\n\r\n\t\t\treturn message;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tstatic xrSessionIsGranted = false;\r\n\r\n\tstatic registerSessionGrantedListener() {\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\tnavigator.xr.addEventListener( 'sessiongranted', () => {\r\n\r\n\t\t\t\tVRButton.xrSessionIsGranted = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nVRButton.registerSessionGrantedListener();\r\n\r\nexport { VRButton };\r\n", "import * as React from \"react\";\n\nexport default function mergeRefs<T = any>(\n  refs: Array<React.MutableRefObject<T> | React.LegacyRef<T>>\n): React.RefCallback<T> {\n  return (value) => {\n    refs.forEach((ref) => {\n      if (typeof ref === \"function\") {\n        ref(value);\n      } else if (ref != null) {\n        (ref as React.MutableRefObject<T | null>).current = value;\n      }\n    });\n  };\n}\n", "import {\r\n\tDynamicDrawUsage,\r\n\tSphereGeometry,\r\n\tBoxGeometry,\r\n\tMeshStandardMaterial,\r\n\tInstancedMesh,\r\n\tMatrix4,\r\n\tVector3\r\n} from 'three';\r\n\r\nconst _matrix = new Matrix4();\r\nconst _vector = new Vector3();\r\n\r\nclass XRHandPrimitiveModel {\r\n\r\n\tconstructor( handModel, controller, path, handedness, options ) {\r\n\r\n\t\tthis.controller = controller;\r\n\t\tthis.handModel = handModel;\r\n\t\tthis.envMap = null;\r\n\r\n\t\tlet geometry;\r\n\r\n\t\tif ( ! options || ! options.primitive || options.primitive === 'sphere' ) {\r\n\r\n\t\t\tgeometry = new SphereGeometry( 1, 10, 10 );\r\n\r\n\t\t} else if ( options.primitive === 'box' ) {\r\n\r\n\t\t\tgeometry = new BoxGeometry( 1, 1, 1 );\r\n\r\n\t\t}\r\n\r\n\t\tconst material = new MeshStandardMaterial();\r\n\r\n\t\tthis.handMesh = new InstancedMesh( geometry, material, 30 );\r\n\t\tthis.handMesh.instanceMatrix.setUsage( DynamicDrawUsage ); // will be updated every frame\r\n\t\tthis.handMesh.castShadow = true;\r\n\t\tthis.handMesh.receiveShadow = true;\r\n\t\tthis.handModel.add( this.handMesh );\r\n\r\n\t\tthis.joints = [\r\n\t\t\t'wrist',\r\n\t\t\t'thumb-metacarpal',\r\n\t\t\t'thumb-phalanx-proximal',\r\n\t\t\t'thumb-phalanx-distal',\r\n\t\t\t'thumb-tip',\r\n\t\t\t'index-finger-metacarpal',\r\n\t\t\t'index-finger-phalanx-proximal',\r\n\t\t\t'index-finger-phalanx-intermediate',\r\n\t\t\t'index-finger-phalanx-distal',\r\n\t\t\t'index-finger-tip',\r\n\t\t\t'middle-finger-metacarpal',\r\n\t\t\t'middle-finger-phalanx-proximal',\r\n\t\t\t'middle-finger-phalanx-intermediate',\r\n\t\t\t'middle-finger-phalanx-distal',\r\n\t\t\t'middle-finger-tip',\r\n\t\t\t'ring-finger-metacarpal',\r\n\t\t\t'ring-finger-phalanx-proximal',\r\n\t\t\t'ring-finger-phalanx-intermediate',\r\n\t\t\t'ring-finger-phalanx-distal',\r\n\t\t\t'ring-finger-tip',\r\n\t\t\t'pinky-finger-metacarpal',\r\n\t\t\t'pinky-finger-phalanx-proximal',\r\n\t\t\t'pinky-finger-phalanx-intermediate',\r\n\t\t\t'pinky-finger-phalanx-distal',\r\n\t\t\t'pinky-finger-tip'\r\n\t\t];\r\n\r\n\t}\r\n\r\n\tupdateMesh() {\r\n\r\n\t\tconst defaultRadius = 0.008;\r\n\t\tconst joints = this.controller.joints;\r\n\r\n\t\tlet count = 0;\r\n\r\n\t\tfor ( let i = 0; i < this.joints.length; i ++ ) {\r\n\r\n\t\t\tconst joint = joints[ this.joints[ i ] ];\r\n\r\n\t\t\tif ( joint.visible ) {\r\n\r\n\t\t\t\t_vector.setScalar( joint.jointRadius || defaultRadius );\r\n\t\t\t\t_matrix.compose( joint.position, joint.quaternion, _vector );\r\n\t\t\t\tthis.handMesh.setMatrixAt( i, _matrix );\r\n\r\n\t\t\t\tcount ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.handMesh.count = count;\r\n\t\tthis.handMesh.instanceMatrix.needsUpdate = true;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { XRHandPrimitiveModel };\r\n", "import { GLTFLoader } from '../loaders/GLTFLoader.js';\r\n\r\nconst DEFAULT_HAND_PROFILE_PATH = 'https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/';\r\n\r\nclass XRHandMeshModel {\r\n\r\n\tconstructor( handModel, controller, path, handedness ) {\r\n\r\n\t\tthis.controller = controller;\r\n\t\tthis.handModel = handModel;\r\n\r\n\t\tthis.bones = [];\r\n\r\n\t\tconst loader = new GLTFLoader();\r\n\t\tloader.setPath( path || DEFAULT_HAND_PROFILE_PATH );\r\n\t\tloader.load( `${handedness}.glb`, gltf => {\r\n\r\n\t\t\tconst object = gltf.scene.children[ 0 ];\r\n\t\t\tthis.handModel.add( object );\r\n\r\n\t\t\tconst mesh = object.getObjectByProperty( 'type', 'SkinnedMesh' );\r\n\t\t\tmesh.frustumCulled = false;\r\n\t\t\tmesh.castShadow = true;\r\n\t\t\tmesh.receiveShadow = true;\r\n\r\n\t\t\tconst joints = [\r\n\t\t\t\t'wrist',\r\n\t\t\t\t'thumb-metacarpal',\r\n\t\t\t\t'thumb-phalanx-proximal',\r\n\t\t\t\t'thumb-phalanx-distal',\r\n\t\t\t\t'thumb-tip',\r\n\t\t\t\t'index-finger-metacarpal',\r\n\t\t\t\t'index-finger-phalanx-proximal',\r\n\t\t\t\t'index-finger-phalanx-intermediate',\r\n\t\t\t\t'index-finger-phalanx-distal',\r\n\t\t\t\t'index-finger-tip',\r\n\t\t\t\t'middle-finger-metacarpal',\r\n\t\t\t\t'middle-finger-phalanx-proximal',\r\n\t\t\t\t'middle-finger-phalanx-intermediate',\r\n\t\t\t\t'middle-finger-phalanx-distal',\r\n\t\t\t\t'middle-finger-tip',\r\n\t\t\t\t'ring-finger-metacarpal',\r\n\t\t\t\t'ring-finger-phalanx-proximal',\r\n\t\t\t\t'ring-finger-phalanx-intermediate',\r\n\t\t\t\t'ring-finger-phalanx-distal',\r\n\t\t\t\t'ring-finger-tip',\r\n\t\t\t\t'pinky-finger-metacarpal',\r\n\t\t\t\t'pinky-finger-phalanx-proximal',\r\n\t\t\t\t'pinky-finger-phalanx-intermediate',\r\n\t\t\t\t'pinky-finger-phalanx-distal',\r\n\t\t\t\t'pinky-finger-tip',\r\n\t\t\t];\r\n\r\n\t\t\tjoints.forEach( jointName => {\r\n\r\n\t\t\t\tconst bone = object.getObjectByName( jointName );\r\n\r\n\t\t\t\tif ( bone !== undefined ) {\r\n\r\n\t\t\t\t\tbone.jointName = jointName;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( `Couldn't find ${jointName} in ${handedness} hand mesh` );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.bones.push( bone );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tupdateMesh() {\r\n\r\n\t\t// XR Joints\r\n\t\tconst XRJoints = this.controller.joints;\r\n\r\n\t\tfor ( let i = 0; i < this.bones.length; i ++ ) {\r\n\r\n\t\t\tconst bone = this.bones[ i ];\r\n\r\n\t\t\tif ( bone ) {\r\n\r\n\t\t\t\tconst XRJoint = XRJoints[ bone.jointName ];\r\n\r\n\t\t\t\tif ( XRJoint.visible ) {\r\n\r\n\t\t\t\t\tconst position = XRJoint.position;\r\n\r\n\t\t\t\t\tbone.position.copy( position );\r\n\t\t\t\t\tbone.quaternion.copy( XRJoint.quaternion );\r\n\t\t\t\t\t// bone.scale.setScalar( XRJoint.jointRadius || defaultRadius );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { XRHandMeshModel };\r\n", "import {\r\n\tObject3D\r\n} from 'three';\r\n\r\nimport {\r\n\tXRHandPrimitiveModel\r\n} from './XRHandPrimitiveModel.js';\r\n\r\nimport {\r\n\tXRHandMeshModel\r\n} from './XRHandMeshModel.js';\r\n\r\nclass XRHandModel extends Object3D {\r\n\r\n\tconstructor( controller ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.controller = controller;\r\n\t\tthis.motionController = null;\r\n\t\tthis.envMap = null;\r\n\r\n\t\tthis.mesh = null;\r\n\r\n\t}\r\n\r\n\tupdateMatrixWorld( force ) {\r\n\r\n\t\tsuper.updateMatrixWorld( force );\r\n\r\n\t\tif ( this.motionController ) {\r\n\r\n\t\t\tthis.motionController.updateMesh();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass XRHandModelFactory {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.path = null;\r\n\r\n\t}\r\n\r\n\tsetPath( path ) {\r\n\r\n\t\tthis.path = path;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcreateHandModel( controller, profile ) {\r\n\r\n\t\tconst handModel = new XRHandModel( controller );\r\n\r\n\t\tcontroller.addEventListener( 'connected', ( event ) => {\r\n\r\n\t\t\tconst xrInputSource = event.data;\r\n\r\n\t\t\tif ( xrInputSource.hand && ! handModel.motionController ) {\r\n\r\n\t\t\t\thandModel.xrInputSource = xrInputSource;\r\n\r\n\t\t\t\t// @todo Detect profile if not provided\r\n\t\t\t\tif ( profile === undefined || profile === 'spheres' ) {\r\n\r\n\t\t\t\t\thandModel.motionController = new XRHandPrimitiveModel( handModel, controller, this.path, xrInputSource.handedness, { primitive: 'sphere' } );\r\n\r\n\t\t\t\t} else if ( profile === 'boxes' ) {\r\n\r\n\t\t\t\t\thandModel.motionController = new XRHandPrimitiveModel( handModel, controller, this.path, xrInputSource.handedness, { primitive: 'box' } );\r\n\r\n\t\t\t\t} else if ( profile === 'mesh' ) {\r\n\r\n\t\t\t\t\thandModel.motionController = new XRHandMeshModel( handModel, controller, this.path, xrInputSource.handedness );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tcontroller.addEventListener( 'disconnected', () => {\r\n\r\n\t\t\t// handModel.motionController = null;\r\n\t\t\t// handModel.remove( scene );\r\n\t\t\t// scene = null;\r\n\r\n\t\t} );\r\n\r\n\t\treturn handModel;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { XRHandModelFactory };\r\n"],
  "mappings": "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",
  "names": ["self", "sourceURI", "node", "accessor", "mergeRefs", "refs", "value", "forEach", "ref", "current", "React__default"]
}
